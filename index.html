<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á¶è„Å®„ÅÑ„Å£„Åó„Çá</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body class="bg-gray-100">
    <div id="app"></div>
    <script>
        const APP_VERSION = 'v1.6.3';

        const firebaseConfig = {
            apiKey: "AIzaSyAqGO0-RnJAfQqsIunx35ZuAGc85cFD-lA",
            authDomain: "walking-36c5a.firebaseapp.com",
            projectId: "walking-36c5a",
            storageBucket: "walking-36c5a.firebasestorage.app",
            messagingSenderId: "457304106244",
            appId: "1:457304106244:web:3bcb8df4d4a3b27a971c51"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const functions = firebase.app().functions('asia-northeast1');
        const { useState, useEffect, useRef } = React;

        const badges = [
            { id: 'first', name: 'Âàù„ÇÅ„Å¶„ÅÆÊï£Ê≠©', icon: 'üéâ', condition: (c) => c >= 1 },
            { id: 'ten', name: 'Êï£Ê≠©10Âõû', icon: 'üåü', condition: (c) => c >= 10 },
            { id: 'fifty', name: 'Êï£Ê≠©50Âõû', icon: '‚≠ê', condition: (c) => c >= 50 },
            { id: 'hundred', name: 'Êï£Ê≠©100Âõû', icon: 'üëë', condition: (c) => c >= 100 },
            { id: 'distance10', name: 'ÂêàË®à10km', icon: 'üèÉ', condition: (c, d) => d >= 10000 },
            { id: 'distance50', name: 'ÂêàË®à50km', icon: 'üöÄ', condition: (c, d) => d >= 50000 },
            { id: 'distance100', name: 'ÂêàË®à100km', icon: 'üéñÔ∏è', condition: (c, d) => d >= 100000 }
        ];

        // OpenWeatherMap APIË®≠ÂÆö
        // Ê≥®ÊÑè: Êú¨Áï™ÂÖ¨ÈñãÊôÇ„ÅØAPIÁÆ°ÁêÜÁîªÈù¢„Åß„É™„Éï„Ç°„É©„ÉºÂà∂Èôê„Çí„Åã„Åë„Å¶„Åè„Å†„Åï„ÅÑ
        const WEATHER_API_KEY = "ba80598060806c2e4741766d34286357";

        // Â§©Ê∞óÊÉÖÂ†±„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
        const fetchWeatherData = async (lat, lng) => {
            try {
                if (!WEATHER_API_KEY) return null;

                // units=metric „ÅßÊëÇÊ∞è„Éª„É°„Éº„Éà„É´Ê≥ï„ÇíÊåáÂÆö„ÄÅlang=ja „ÅßÊó•Êú¨Ë™ûÂåñ
                const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${WEATHER_API_KEY}&units=metric&lang=ja`;

                const response = await fetch(url);
                if (!response.ok) throw new Error('Weather API Error');

                const data = await response.json();

                return {
                    condition: data.weather[0].description, // "Êô¥„Çå" "Âéö„ÅÑÈõ≤" „Å™„Å©
                    icon: data.weather[0].icon,             // „Ç¢„Ç§„Ç≥„É≥„Ç≥„Éº„Éâ
                    temp: Math.round(data.main.temp * 10) / 10, // Â∞èÊï∞ÁÇπÁ¨¨1‰Ωç„Åæ„Åß
                    wind: Math.round(data.wind.speed * 10) / 10 // Â∞èÊï∞ÁÇπÁ¨¨1‰Ωç„Åæ„Åß
                };
            } catch (error) {
                console.warn("Â§©Ê∞óÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„Åå„ÄÅÂá¶ÁêÜ„ÇíÁ∂ôÁ∂ö„Åó„Åæ„Åô:", error);
                return null; // Â§±ÊïóÊôÇ„ÅØnull„ÇíËøî„Åó„ÄÅË®òÈå≤„Çí‰∏≠Êñ≠„Åï„Åõ„Å™„ÅÑ
            }
        };

        // Â§©Ê∞ó„Ç¢„Ç§„Ç≥„É≥„Ç≥„Éº„Éâ„ÇíÁµµÊñáÂ≠ó„Å´Â§âÊèõ„Åô„Çã„Éò„É´„Éë„ÉºÈñ¢Êï∞ÔºàË°®Á§∫Áî®Ôºâ
        const getWeatherEmoji = (iconCode) => {
            if (!iconCode) return 'üå§Ô∏è';
            // OpenWeatherMap„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Ç≥„Éº„Éâ„Å´Âü∫„Å•„ÅèÁ∞°Êòì„Éû„ÉÉ„Éî„É≥„Ç∞
            const map = {
                '01': '‚òÄÔ∏è', // Âø´Êô¥
                '02': '‚õÖ', // Êô¥„ÇåÊôÇ„ÄÖÊõá„Çä
                '03': '‚òÅÔ∏è', // Êõá„Çä
                '04': '‚òÅÔ∏è', // Âéö„ÅÑÈõ≤
                '09': 'üåßÔ∏è', // Â∞èÈõ®
                '10': '‚òî', // Èõ®
                '11': '‚ö°', // Èõ∑
                '13': '‚õÑ', // Èõ™
                '50': 'üå´Ô∏è', // Èúß
            };
            const code = iconCode.substring(0, 2);
            return map[code] || 'üå§Ô∏è';
        };

        // ÁîªÂÉèÂúßÁ∏Æ„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
        const compressImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 1200;
                        const scaleSize = img.width > MAX_WIDTH ? MAX_WIDTH / img.width : 1;
                        canvas.width = img.width * scaleSize;
                        canvas.height = img.height * scaleSize;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        canvas.toBlob((blob) => {
                            if (blob) {
                                resolve(blob);
                            } else {
                                reject(new Error('Image compression failed'));
                            }
                        }, 'image/jpeg', 0.7);
                    };
                    img.onerror = (error) => reject(error);
                };
                reader.onerror = (error) => reject(error);
            });
        };

        function getMonday(d) {
            const date = new Date(d);
            const day = date.getDay();
            const diff = date.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(date.setDate(diff));
        }

        function getPeriodLabel(period) {
            const now = new Date();
            if (period === 'week') {
                const monday = getMonday(now);
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                return `‰ªäÈÄ± (${monday.getMonth() + 1}/${monday.getDate()}„Äú${sunday.getMonth() + 1}/${sunday.getDate()})`;
            } else if (period === 'month') {
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                return `‰ªäÊúà (${firstDay.getMonth() + 1}/${firstDay.getDate()}„Äú${lastDay.getMonth() + 1}/${lastDay.getDate()})`;
            } else if (period === 'year') {
                return `‰ªäÂπ¥ (${now.getFullYear()}Âπ¥)`;
            } else {
                return 'ÂÖ®ÊúüÈñì';
            }
        }

        // ÂÜôÁúüÊã°Â§ß„Éì„É•„Éº„ÉØ„Éº
        function PhotoViewer({ src, onClose }) {
            const [scale, setScale] = useState(1);

            useEffect(() => {
                document.body.style.overflow = 'hidden';
                return () => document.body.style.overflow = 'auto';
            }, []);

            return React.createElement('div', {
                className: 'fixed inset-0 bg-black z-[60] flex items-center justify-center overflow-hidden',
                onClick: onClose
            },
                React.createElement('div', { className: 'absolute top-4 right-4 z-10 flex gap-4' },
                    React.createElement('button', {
                        className: 'bg-gray-800 text-white p-3 rounded-full opacity-80 hover:opacity-100',
                        onClick: (e) => { e.stopPropagation(); setScale(s => Math.min(s + 0.5, 3)); }
                    }, '‚ûï'),
                    React.createElement('button', {
                        className: 'bg-gray-800 text-white p-3 rounded-full opacity-80 hover:opacity-100',
                        onClick: (e) => { e.stopPropagation(); setScale(s => Math.max(s - 0.5, 1)); }
                    }, '‚ûñ'),
                    React.createElement('button', {
                        className: 'bg-white text-black p-3 rounded-full opacity-80 hover:opacity-100 font-bold',
                        onClick: onClose
                    }, '‚úï')
                ),
                React.createElement('img', {
                    src: src,
                    className: 'transition-transform duration-200 ease-out max-w-full max-h-full object-contain',
                    style: { transform: `scale(${scale})` },
                    onClick: (e) => e.stopPropagation()
                })
            );
        }

        function MapView({ positions, onClose }) {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);

            useEffect(() => {
                if (!positions || positions.length === 0 || !mapRef.current) return;

                if (!mapInstanceRef.current) {
                    mapInstanceRef.current = L.map(mapRef.current).setView(
                        [positions[0].lat, positions[0].lng],
                        15
                    );
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(mapInstanceRef.current);
                }

                const latLngs = positions.map(p => [p.lat, p.lng]);
                L.polyline(latLngs, { color: 'blue', weight: 4 }).addTo(mapInstanceRef.current);

                if (latLngs.length > 0) {
                    mapInstanceRef.current.fitBounds(latLngs);
                }

                return () => {
                    if (mapInstanceRef.current) {
                        mapInstanceRef.current.remove();
                        mapInstanceRef.current = null;
                    }
                };
            }, [positions]);

            return React.createElement('div', {
                className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4'
            },
                React.createElement('div', { className: 'bg-white rounded-lg w-full max-w-2xl' },
                    React.createElement('div', { className: 'p-4 border-b flex justify-between items-center' },
                        React.createElement('h3', { className: 'font-bold text-lg' }, 'üó∫Ô∏è Êï£Ê≠©„Ç≥„Éº„Çπ'),
                        React.createElement('button', {
                            onClick: onClose,
                            className: 'text-gray-500 hover:text-gray-700 text-2xl'
                        }, '√ó')
                    ),
                    React.createElement('div', {
                        ref: mapRef,
                        className: 'w-full h-96'
                    })
                )
            );
        }

        function WalkEditForm({ walk, walkers, onSave, onCancel }) {
            const [formData, setFormData] = useState({
                walkers: walk.walkers || [],
                pee: walk.pee || false,
                poo: walk.poo || false,
                water: walk.water || false,
                memo: walk.memo || '',
                photos: walk.photos || []
            });
            const [uploading, setUploading] = useState(false);

            const toggleWalker = (walkerName) => {
                setFormData(prev => ({
                    ...prev,
                    walkers: prev.walkers.includes(walkerName)
                        ? prev.walkers.filter(w => w !== walkerName)
                        : [...prev.walkers, walkerName]
                }));
            };

            const handlePhotoUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                setUploading(true);
                try {
                    const uploadPromises = files.map(async (file) => {
                        const compressedBlob = await compressImage(file);
                        const randomId = Math.random().toString(36).substring(7);
                        const fileName = file.name.split('.')[0] + '.jpg';
                        const ref = storage.ref(`walks/${Date.now()}_${randomId}_${fileName}`);
                        await ref.put(compressedBlob);
                        return await ref.getDownloadURL();
                    });

                    const newUrls = await Promise.all(uploadPromises);
                    setFormData(prev => ({ ...prev, photos: [...prev.photos, ...newUrls] }));
                } catch (err) {
                    alert('„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + err);
                } finally {
                    setUploading(false);
                    e.target.value = '';
                }
            };

            const removePhoto = (index) => {
                setFormData(prev => ({
                    ...prev,
                    photos: prev.photos.filter((_, i) => i !== index)
                }));
            };

            const handleSubmit = () => {
                if (formData.walkers.length === 0) {
                    alert('Êï£Ê≠©ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                onSave(formData);
            };

            return React.createElement('div', {
                className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4'
            },
                React.createElement('div', {
                    className: 'bg-white rounded-lg w-full max-w-md max-h-screen overflow-y-auto'
                },
                    React.createElement('div', { className: 'p-4' },
                        React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'Êï£Ê≠©Ë®òÈå≤„ÇíÁ∑®ÈõÜ'),
                        React.createElement('div', { className: 'space-y-4' },
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Êï£Ê≠©ËÄÖ'),
                                React.createElement('div', { className: 'space-y-2' },
                                    walkers.map(w => React.createElement('label', {
                                        key: w.id,
                                        className: 'flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50'
                                    },
                                        React.createElement('input', {
                                            type: 'checkbox',
                                            checked: formData.walkers.includes(w.name),
                                            onChange: () => toggleWalker(w.name),
                                            className: 'mr-2 w-5 h-5'
                                        }),
                                        React.createElement('span', null, w.name)
                                    ))
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Ë®òÈå≤'),
                                React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                                    React.createElement('button', {
                                        onClick: () => setFormData({ ...formData, pee: !formData.pee }),
                                        type: 'button',
                                        className: `py-3 rounded-lg border-2 ${formData.pee ? 'bg-yellow-100 border-yellow-500' : 'border-gray-300'}`
                                    }, 'üíß „Åä„Åó„Å£„Åì'),
                                    React.createElement('button', {
                                        onClick: () => setFormData({ ...formData, poo: !formData.poo }),
                                        type: 'button',
                                        className: `py-3 rounded-lg border-2 ${formData.poo ? 'bg-amber-100 border-amber-500' : 'border-gray-300'}`
                                    }, 'üí© „ÅÜ„Çì„Å°'),
                                    React.createElement('button', {
                                        onClick: () => setFormData({ ...formData, water: !formData.water }),
                                        type: 'button',
                                        className: `py-3 rounded-lg border-2 ${formData.water ? 'bg-blue-100 border-blue-500' : 'border-gray-300'}`
                                    }, 'üíß Ê∞¥')
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ÂÜôÁúü'),
                                React.createElement('div', { className: 'grid grid-cols-4 gap-2 mb-2' },
                                    formData.photos.map((url, i) => React.createElement('div', { key: i, className: 'relative' },
                                        React.createElement('img', { src: url, className: 'w-full h-16 object-cover rounded' }),
                                        React.createElement('button', {
                                            onClick: () => removePhoto(i),
                                            className: 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 text-xs'
                                        }, '√ó')
                                    ))
                                ),
                                React.createElement('input', {
                                    type: 'file', accept: 'image/*', multiple: true,
                                    onChange: handlePhotoUpload,
                                    disabled: uploading,
                                    className: 'w-full text-sm'
                                }),
                                uploading && React.createElement('p', { className: 'text-sm text-gray-500' }, '„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠...')
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, '„É°„É¢'),
                                React.createElement('textarea', {
                                    value: formData.memo,
                                    onChange: (e) => setFormData({ ...formData, memo: e.target.value }),
                                    className: 'w-full p-2 border rounded-lg',
                                    rows: 3
                                })
                            ),
                            React.createElement('div', { className: 'flex gap-2' },
                                React.createElement('button', {
                                    onClick: handleSubmit,
                                    className: 'flex-1 bg-blue-500 text-white py-2 rounded-lg'
                                }, '‰øùÂ≠ò'),
                                React.createElement('button', {
                                    onClick: onCancel,
                                    className: 'flex-1 bg-gray-300 py-2 rounded-lg'
                                }, '„Ç≠„É£„É≥„Çª„É´')
                            )
                        )
                    )
                )
            );
        }

        function HealthForm({ type, walkers, formData, onChange, onSave, onCancel }) {
            const handleSubmit = () => {
                if (!formData.walker) {
                    alert('ÊãÖÂΩìËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                if (type === 'hospital' && !formData.hospitalName) {
                    alert('ÁóÖÈô¢Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                if (type === 'grooming' && formData.groomedBy === 'shop' && !formData.shopName) {
                    alert('Â∫óËàóÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                if (type === 'medicine' && !formData.medicineType) {
                    alert('Ëñ¨„ÅÆÁ®ÆÈ°û„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                onSave(formData);
            };

            const getFirmnessLabel = (value) => {
                const labels = {
                    1: '„Å®„Å¶„ÇÇ„ÇÑ„Çè„Çâ„Åã„ÅÑ',
                    2: '„ÇÑ„Çè„Çâ„Åã„ÅÑ',
                    3: 'ÊôÆÈÄö',
                    4: 'Á°¨„ÇÅ',
                    5: 'Á°¨„ÅÑ'
                };
                return labels[value];
            };

            // „ÅîÈ£Ø„ÅÆÊÆãÈáè„É©„Éô„É´
            const getFoodAmountLabel = (value) => {
                const labels = {
                    1: 'Á©∫„Å£„ÅΩ',
                    2: 'Â∞ë„Åó',
                    3: 'ÊôÆÈÄö',
                    4: 'Â§ö„ÇÅ',
                    5: 'Ê∫ÄÊùØ'
                };
                return labels[value] + ` (${value}/5)`;
            };

            return React.createElement('div', { className: 'space-y-4 bg-white p-4 rounded-lg' },
                React.createElement('h3', { className: 'font-bold text-lg' },
                    (formData.id ? '‚úèÔ∏è Á∑®ÈõÜ: ' : '') +
                    (type === 'hospital' ? 'üè• ÁóÖÈô¢Ë®òÈå≤' :
                        type === 'grooming' ? '‚úÇÔ∏è Êï£È´™Ë®òÈå≤' :
                            type === 'bath' ? 'üõÅ ÂÖ•Êµ¥Ë®òÈå≤' :
                                type === 'food' ? 'ü•£ „ÅîÈ£Ø' :
                                    type === 'excretion' ? 'üí© ÊéíÊ≥ÑË®òÈå≤' : 'üíä Ëñ¨Ë®òÈå≤')
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ÊãÖÂΩìËÄÖ'),
                    React.createElement('select', {
                        value: formData.walker,
                        onChange: (e) => onChange({ ...formData, walker: e.target.value }),
                        className: 'w-full p-2 border rounded'
                    },
                        React.createElement('option', { value: '' }, 'ÊãÖÂΩìËÄÖ„ÇíÈÅ∏Êäû'),
                        walkers.map(w => React.createElement('option', { key: w.id, value: w.name }, w.name))
                    )
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Êó•‰ªò'),
                    React.createElement('input', {
                        type: 'date',
                        value: formData.date,
                        onChange: (e) => onChange({ ...formData, date: e.target.value }),
                        className: 'w-full p-2 border rounded'
                    })
                ),
                (type === 'excretion' || type === 'hospital' || type === 'food') && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ÊôÇÂàª'),
                    React.createElement('input', {
                        type: 'time',
                        value: formData.time,
                        onChange: (e) => onChange({ ...formData, time: e.target.value }),
                        className: 'w-full p-2 border rounded'
                    })
                ),
                type === 'hospital' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ÁóÖÈô¢Âêç'),
                    React.createElement('input', {
                        type: 'text',
                        value: formData.hospitalName,
                        onChange: (e) => onChange({ ...formData, hospitalName: e.target.value }),
                        className: 'w-full p-2 border rounded',
                        placeholder: '‰æã: ‚óã‚óãÂãïÁâ©ÁóÖÈô¢'
                    }),
                    React.createElement('label', { className: 'block text-sm font-medium mb-1 mt-2' }, 'ÁêÜÁî±'),
                    React.createElement('input', {
                        type: 'text',
                        value: formData.reason,
                        onChange: (e) => onChange({ ...formData, reason: e.target.value }),
                        className: 'w-full p-2 border rounded',
                        placeholder: '‰æã: ÂÆöÊúüÊ§úË®∫'
                    })
                ),
                type === 'grooming' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ÂÆüÊñΩÂ†¥ÊâÄ'),
                    React.createElement('div', { className: 'space-y-2' },
                        React.createElement('label', { className: 'flex items-center' },
                            React.createElement('input', {
                                type: 'radio',
                                name: 'groomedBy',
                                value: 'walker',
                                checked: formData.groomedBy === 'walker',
                                onChange: (e) => onChange({ ...formData, groomedBy: e.target.value }),
                                className: 'mr-2'
                            }),
                            'Ëá™ÂÆÖ'
                        ),
                        React.createElement('label', { className: 'flex items-center' },
                            React.createElement('input', {
                                type: 'radio',
                                name: 'groomedBy',
                                value: 'shop',
                                checked: formData.groomedBy === 'shop',
                                onChange: (e) => onChange({ ...formData, groomedBy: e.target.value }),
                                className: 'mr-2'
                            }),
                            'Â∫óËàó'
                        ),
                        formData.groomedBy === 'shop' && React.createElement('input', {
                            type: 'text',
                            value: formData.shopName,
                            onChange: (e) => onChange({ ...formData, shopName: e.target.value }),
                            className: 'w-full p-2 border rounded ml-6',
                            placeholder: 'Â∫óËàóÂêç„ÇíÂÖ•Âäõ'
                        })
                    )
                ),
                type === 'medicine' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Ëñ¨„ÅÆÁ®ÆÈ°û'),
                    React.createElement('input', {
                        type: 'text',
                        value: formData.medicineType,
                        onChange: (e) => onChange({ ...formData, medicineType: e.target.value }),
                        className: 'w-full p-2 border rounded',
                        placeholder: '‰æã: „Éï„Ç£„É©„É™„Ç¢‰∫àÈò≤Ëñ¨'
                    }),
                    React.createElement('label', { className: 'flex items-center mt-2' },
                        React.createElement('input', {
                            type: 'checkbox',
                            checked: formData.isVaccine,
                            onChange: (e) => onChange({ ...formData, isVaccine: e.target.checked }),
                            className: 'mr-2'
                        }),
                        '‰∫àÈò≤Êé•Á®Æ'
                    )
                ),
                type === 'excretion' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' },
                        '„ÅÜ„Çì„Å°„ÅÆÁ°¨„Åï: ' + getFirmnessLabel(formData.pooFirmness)
                    ),
                    React.createElement('input', {
                        type: 'range',
                        min: 1,
                        max: 5,
                        value: formData.pooFirmness,
                        onChange: (e) => onChange({ ...formData, pooFirmness: parseInt(e.target.value) }),
                        className: 'w-full'
                    }),
                    React.createElement('div', { className: 'flex justify-between text-xs text-gray-500 mt-1' },
                        React.createElement('span', null, '„ÇÑ„Çè„Çâ„Åã„ÅÑ'),
                        React.createElement('span', null, 'ÊôÆÈÄö'),
                        React.createElement('span', null, 'Á°¨„ÅÑ')
                    )
                ),
                type === 'food' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' },
                        'ÊÆãÈáè: ' + getFoodAmountLabel(formData.foodAmount || 3)
                    ),
                    React.createElement('input', {
                        type: 'range',
                        min: 1,
                        max: 5,
                        value: formData.foodAmount || 3,
                        onChange: (e) => onChange({ ...formData, foodAmount: parseInt(e.target.value) }),
                        className: 'w-full'
                    }),
                    React.createElement('div', { className: 'flex justify-between text-xs text-gray-500 mt-1' },
                        React.createElement('span', null, 'Á©∫'),
                        React.createElement('span', null, 'ÊôÆÈÄö'),
                        React.createElement('span', null, 'Ê∫ÄÊùØ')
                    )
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, '„É°„É¢'),
                    React.createElement('textarea', {
                        value: formData.memo,
                        onChange: (e) => onChange({ ...formData, memo: e.target.value }),
                        className: 'w-full p-2 border rounded',
                        rows: 3,
                        placeholder: 'Ë©≥Á¥∞„Çí„É°„É¢...'
                    })
                ),
                React.createElement('div', { className: 'flex gap-2' },
                    React.createElement('button', {
                        onClick: handleSubmit,
                        className: 'flex-1 bg-blue-500 text-white py-2 rounded font-bold'
                    }, '‰øùÂ≠ò'),
                    React.createElement('button', {
                        onClick: onCancel,
                        className: 'flex-1 bg-gray-300 py-2 rounded'
                    }, '„Ç≠„É£„É≥„Çª„É´')
                )
            );
        }

        function App() {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [isWalking, setIsWalking] = useState(false);
            const [currentWalk, setCurrentWalk] = useState(null);
            const [walks, setWalks] = useState([]);
            const [healthRecords, setHealthRecords] = useState([]);
            const [walkers, setWalkers] = useState([]);
            const [selectedWalkers, setSelectedWalkers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [newWalkerName, setNewWalkerName] = useState('');
            const [showAddWalker, setShowAddWalker] = useState(false);
            const [uploadingPhotos, setUploadingPhotos] = useState(false);
            const [photos, setPhotos] = useState([]);
            const [statsView, setStatsView] = useState('week');
            const [showHealthForm, setShowHealthForm] = useState(false);
            const [healthType, setHealthType] = useState('hospital');
            const [editingWalk, setEditingWalk] = useState(null);
            const [editingHealth, setEditingHealth] = useState(null);
            const [showMap, setShowMap] = useState(null);
            const [viewingPhoto, setViewingPhoto] = useState(null);
            const [now, setNow] = useState(new Date());
            const stationaryTimeRef = useRef(0);
            const lastPositionRef = useRef(null);

            const [healthFormData, setHealthFormData] = useState({});
            const [originalHealthData, setOriginalHealthData] = useState({});

            useEffect(() => {
                let timer;
                if (isWalking) {
                    timer = setInterval(() => setNow(new Date()), 1000);
                }
                return () => clearInterval(timer);
            }, [isWalking]);

            useEffect(() => {
                const unsubscribe = db.collection('walkers').onSnapshot((snapshot) => {
                    const walkerList = snapshot.docs.map(doc => ({
                        ...doc.data(),
                        id: doc.id
                    }));
                    setWalkers(walkerList.sort((a, b) => a.order - b.order));
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const unsubscribe = db.collection('walks')
                    .orderBy('startTime', 'desc')
                    .onSnapshot((snapshot) => {
                        const walkList = snapshot.docs.map(doc => ({
                            ...doc.data(),
                            id: doc.id,
                            startTime: doc.data().startTime?.toDate(),
                            endTime: doc.data().endTime?.toDate()
                        }));
                        setWalks(walkList);
                    });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const unsubscribe = db.collection('health')
                    .orderBy('date', 'desc')
                    .onSnapshot((snapshot) => {
                        const records = snapshot.docs.map(doc => ({
                            ...doc.data(),
                            id: doc.id,
                            date: doc.data().date?.toDate()
                        }));
                        setHealthRecords(records);
                    });
                return () => unsubscribe();
            }, []);

            const initHealthForm = (type, record) => {
                const initialData = {
                    id: record?.id || null,
                    type: record?.type || type,
                    date: record ? new Date(record.date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0],
                    time: record ? new Date(record.date).toTimeString().slice(0, 5) : new Date().toTimeString().slice(0, 5),
                    walker: record?.walker || '',
                    hospitalName: record?.hospitalName || '',
                    reason: record?.reason || '',
                    groomedBy: record?.groomedBy || 'walker',
                    shopName: record?.shopName || '',
                    medicineType: record?.medicineType || '',
                    isVaccine: record?.isVaccine || false,
                    pooFirmness: record?.pooFirmness || 3,
                    foodAmount: record?.foodAmount || 3,
                    memo: record?.memo || ''
                };
                setHealthFormData(initialData);
                setOriginalHealthData(initialData);
                setHealthType(type);
                if (record) setEditingHealth(record);
                setShowHealthForm(true);
            };

            const handleTabChange = (newTab) => {
                if (isWalking && newTab !== 'walk') {
                    alert('Êï£Ê≠©‰∏≠„Åß„ÅôÔºÅ');
                    return;
                }

                if (activeTab === 'health' && showHealthForm) {
                    const isDirty = JSON.stringify(healthFormData) !== JSON.stringify(originalHealthData);
                    if (isDirty) {
                        if (confirm('Â§âÊõ¥ÂÜÖÂÆπ„Çí‰øùÂ≠ò„Åó„Åæ„Åô„ÅãÔºü\nOK: ‰øùÂ≠ò„Åó„Å¶ÁßªÂãï\n„Ç≠„É£„É≥„Çª„É´: Â§âÊõ¥„ÇíÁ†¥Ê£Ñ„Åó„Å¶ÁßªÂãï')) {
                            saveHealthRecord(healthFormData);
                        } else {
                            setShowHealthForm(false);
                            setEditingHealth(null);
                        }
                    } else {
                        setShowHealthForm(false);
                        setEditingHealth(null);
                    }
                }

                setActiveTab(newTab);
            };

            const toggleWalker = (walkerName) => {
                setSelectedWalkers(prev => {
                    if (prev.includes(walkerName)) {
                        return prev.filter(w => w !== walkerName);
                    } else {
                        if (prev.length >= 10) {
                            alert('Êï£Ê≠©ËÄÖ„ÅØÊúÄÂ§ß10‰∫∫„Åæ„Åß„Åß„Åô');
                            return prev;
                        }
                        return [...prev, walkerName];
                    }
                });
            };

            const addWalker = async () => {
                if (!newWalkerName.trim()) return;
                await db.collection('walkers').add({
                    name: newWalkerName.trim(),
                    order: walkers.length
                });
                setNewWalkerName('');
                setShowAddWalker(false);
            };

            const deleteWalker = async (walkerId) => {
                if (confirm('„Åì„ÅÆÊï£Ê≠©ËÄÖ„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                    await db.collection('walkers').doc(walkerId).delete();
                }
            };

            const handlePhotoUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;

                if (photos.length + files.length > 4) {
                    alert('ÂÜôÁúü„ÅØÊúÄÂ§ß4Êûö„Åæ„Åß„Åß„Åô');
                    e.target.value = '';
                    return;
                }

                setUploadingPhotos(true);
                try {
                    const uploadPromises = files.map(async (file) => {
                        const compressedBlob = await compressImage(file);
                        const randomId = Math.random().toString(36).substring(7);
                        const fileName = file.name.split('.')[0] + '.jpg';
                        const ref = storage.ref(`walks/${Date.now()}_${randomId}_${fileName}`);
                        await ref.put(compressedBlob);
                        return await ref.getDownloadURL();
                    });

                    const uploadedUrls = await Promise.all(uploadPromises);
                    setPhotos(prev => [...prev, ...uploadedUrls]);
                } catch (error) {
                    console.error(error);
                    alert('„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
                } finally {
                    setUploadingPhotos(false);
                    e.target.value = '';
                }
            };

            const removePhoto = (index) => {
                setPhotos(photos.filter((_, i) => i !== index));
            };

            const calculateDistance = (lat1, lng1, lat2, lng2) => {
                const R = 6371000;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLng = (lng2 - lng1) * Math.PI / 180;
                const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng / 2) * Math.sin(dLng / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            };

            const calculateTotalDistance = (positions) => {
                if (positions.length < 2) return 0;
                let total = 0;
                for (let i = 1; i < positions.length; i++) {
                    total += calculateDistance(
                        positions[i - 1].lat, positions[i - 1].lng,
                        positions[i].lat, positions[i].lng
                    );
                }
                return total;
            };

            const startWalk = () => {
                if (selectedWalkers.length === 0) {
                    alert('Êï£Ê≠©ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                if (!navigator.geolocation) {
                    alert('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                // „Éô„Éº„Çπ„Å®„Å™„ÇãÊï£Ê≠©„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
                const walk = {
                    walkers: selectedWalkers,
                    startTime: new Date(),
                    positions: [],
                    pee: false,
                    poo: false,
                    water: false,
                    memo: '',
                    photos: [],
                    weather: null // ÂàùÊúüÂÄ§„ÅØnull
                };

                navigator.geolocation.getCurrentPosition(
                    async (position) => { // async„ÇíËøΩÂä†
                        // 1. „Åæ„Åö‰ΩçÁΩÆÊÉÖÂ†±„Çí„Çª„ÉÉ„Éà„Åó„Å¶UI„Çí„ÄåÊï£Ê≠©‰∏≠„Äç„Å´„Åô„ÇãÔºà„É¶„Éº„Ç∂„Éº„ÇíÂæÖ„Åü„Åõ„Å™„ÅÑÔºâ
                        walk.positions.push({
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            time: new Date(),
                            accuracy: position.coords.accuracy
                        });

                        lastPositionRef.current = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            time: Date.now()
                        };
                        stationaryTimeRef.current = 0;

                        // StateÊõ¥Êñ∞ÔºàÊï£Ê≠©ÈñãÂßãÔºâ
                        setCurrentWalk(walk);
                        setIsWalking(true);
                        setPhotos([]);
                        setNow(new Date());

                        const notifyWalkStart = functions.httpsCallable('notifyWalkStart');
                        notifyWalkStart({ walkers: selectedWalkers })
                            .then(() => console.log('LINEÈÄöÁü•ÈÄÅ‰ø°ÊàêÂäü'))
                            .catch(err => console.error('LINEÈÄöÁü•ÈÄÅ‰ø°Â§±Êïó', err));

                        // 2. „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„ÅßÂ§©Ê∞ó„ÇíÂèñÂæó„Åó„ÄÅcurrentWalk„ÇíÊõ¥Êñ∞„Åô„Çã
                        const weatherData = await fetchWeatherData(position.coords.latitude, position.coords.longitude);
                        if (weatherData) {
                            // Èñ¢Êï∞ÂûãÊõ¥Êñ∞„Çí‰Ωø„Å£„Å¶ÊúÄÊñ∞„ÅÆstate„Å´„Éû„Éº„Ç∏„Åô„Çã
                            setCurrentWalk(prev => {
                                if (!prev) return null; // „Åô„Åß„Å´ÁµÇ‰∫Ü„Åó„Å¶„ÅÑ„ÅüÂ†¥Âêà„Å™„Å©„ÇíËÄÉÊÖÆ
                                return { ...prev, weather: weatherData };
                            });
                        }
                    },
                    (error) => {
                        alert('‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ‰ΩçÁΩÆÊÉÖÂ†±„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            };
/*
            const startWalk = () => {
                if (selectedWalkers.length === 0) {
                    alert('Êï£Ê≠©ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                if (!navigator.geolocation) {
                    alert('„Åä‰Ωø„ÅÑ„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØ‰ΩçÁΩÆÊÉÖÂ†±„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }
                const walk = {
                    walkers: selectedWalkers,
                    startTime: new Date(),
                    positions: [],
                    pee: false,
                    poo: false,
                    water: false,
                    memo: '',
                    photos: []
                };
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        walk.positions.push({
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            time: new Date(),
                            accuracy: position.coords.accuracy
                        });
                        lastPositionRef.current = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            time: Date.now()
                        };
                        stationaryTimeRef.current = 0;
                        setCurrentWalk(walk);
                        setIsWalking(true);
                        setPhotos([]);
                        setNow(new Date());
                    },
                    (error) => {
                        alert('‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ‰ΩçÁΩÆÊÉÖÂ†±„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            };
*/
            useEffect(() => {
                if (!isWalking || !currentWalk) return;
                const interval = setInterval(() => {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            if (position.coords.accuracy <= 50) {
                                const newPos = {
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude,
                                    time: new Date(),
                                    accuracy: position.coords.accuracy
                                };
                                if (lastPositionRef.current) {
                                    const distance = calculateDistance(
                                        lastPositionRef.current.lat,
                                        lastPositionRef.current.lng,
                                        newPos.lat,
                                        newPos.lng
                                    );
                                    if (distance <= 10) {
                                        stationaryTimeRef.current += 5;
                                        if (stationaryTimeRef.current >= 300) {
                                            endWalk();
                                            alert('5ÂàÜÈñìÁßªÂãï„Åå„Å™„Åã„Å£„Åü„Åü„ÇÅ„ÄÅÊï£Ê≠©„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ');
                                            stationaryTimeRef.current = 0;
                                        }
                                    } else {
                                        stationaryTimeRef.current = 0;
                                    }
                                    lastPositionRef.current = {
                                        lat: newPos.lat,
                                        lng: newPos.lng,
                                        time: Date.now()
                                    };
                                }
                                setCurrentWalk(prev => ({
                                    ...prev,
                                    positions: [...prev.positions, newPos]
                                }));
                            }
                        },
                        (error) => {
                            console.log('GPSÂèñÂæó„Ç®„É©„Éº:', error);
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 10000,
                            maximumAge: 0
                        }
                    );
                }, 5000);
                return () => clearInterval(interval);
            }, [isWalking, currentWalk, photos]);

            const endWalk = async () => {
                if (!currentWalk) return;
                const endTime = new Date();
                const duration = Math.floor((endTime - currentWalk.startTime) / 60000);
                const distance = calculateTotalDistance(currentWalk.positions);
                await db.collection('walks').add({
                    walkers: currentWalk.walkers,
                    startTime: firebase.firestore.Timestamp.fromDate(currentWalk.startTime),
                    endTime: firebase.firestore.Timestamp.fromDate(endTime),
                    duration,
                    distance,
                    pee: currentWalk.pee,
                    poo: currentWalk.poo,
                    water: currentWalk.water,
                    memo: currentWalk.memo,
                    photos: photos,
                    positions: currentWalk.positions,
                    // „ÄêËøΩÂä†„Äë
                    weather: currentWalk.weather || null
                });
                setCurrentWalk(null);
                setIsWalking(false);
                setSelectedWalkers([]);
                setPhotos([]);
                stationaryTimeRef.current = 0;
                lastPositionRef.current = null;
            };

            const updateWalk = async (walkId, data) => {
                await db.collection('walks').doc(walkId).update(data);
                setEditingWalk(null);
            };

            const deleteWalk = async (walkId) => {
                if (confirm('„Åì„ÅÆÊï£Ê≠©Ë®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                    await db.collection('walks').doc(walkId).delete();
                }
            };

            const saveHealthRecord = async (data) => {
                const dateTime = (data.type === 'excretion' || data.type === 'hospital' || data.type === 'food') && data.time
                    ? new Date(`${data.date}T${data.time}`)
                    : new Date(data.date);

                const recordData = {
                    ...data,
                    date: firebase.firestore.Timestamp.fromDate(dateTime)
                };

                delete recordData.id;

                if (data.id) {
                    await db.collection('health').doc(data.id).update(recordData);
                } else {
                    await db.collection('health').add(recordData);
                }

                setShowHealthForm(false);
                setEditingHealth(null);
            };

            const deleteHealthRecord = async (id) => {
                if (!id) { alert('ID„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì'); return; }
                if (confirm('„Åì„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                    try {
                        await db.collection('health').doc(id).delete();
                    } catch (e) {
                        alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + e);
                    }
                }
            };

            const formatDate = (date) => {
                if (!date) return '';
                const d = new Date(date);
                const year = d.getFullYear().toString().slice(-2);
                return `${year}/${d.getMonth() + 1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`;
            };

            const formatDateOnly = (date) => {
                if (!date) return '';
                const d = new Date(date);
                const year = d.getFullYear().toString().slice(-2);
                return `${year}/${d.getMonth() + 1}/${d.getDate()}`;
            };

            const formatTimer = (start) => {
                if (!start) return '0ÂàÜ00Áßí';
                const diffMs = now - start;
                const mins = Math.floor(diffMs / 60000);
                const secs = Math.floor((diffMs % 60000) / 1000);
                return `${mins}ÂàÜ${secs.toString().padStart(2, '0')}Áßí`;
            };

            const getStats = (period) => {
                const now = new Date();
                const startDate = new Date();
                if (period === 'week') {
                    const monday = getMonday(now);
                    startDate.setTime(monday.getTime());
                    startDate.setHours(0, 0, 0, 0);
                } else if (period === 'month') {
                    startDate.setDate(1);
                    startDate.setHours(0, 0, 0, 0);
                } else if (period === 'year') {
                    startDate.setMonth(0, 1);
                    startDate.setHours(0, 0, 0, 0);
                } else {
                    startDate.setFullYear(2000, 0, 1);
                }
                const filteredWalks = period === 'all' ? walks : walks.filter(w => w.startTime >= startDate);
                const totalDistance = filteredWalks.reduce((sum, w) => sum + (w.distance || 0), 0);
                const totalDuration = filteredWalks.reduce((sum, w) => sum + (w.duration || 0), 0);

                // ËøΩÂä†: ÂÅ•Â∫∑Ë®òÈå≤„ÅÆÈõÜË®à
                const filteredHealth = period === 'all' ? healthRecords : healthRecords.filter(r => r.date >= startDate);
                const mealCount = filteredHealth.filter(r => r.type === 'food').length;
                const pooCount = filteredHealth.filter(r => r.type === 'excretion').length;

                const walkerStats = {};
                filteredWalks.forEach(w => {
                    const walkerList = Array.isArray(w.walkers) ? w.walkers : [w.walkers];
                    walkerList.forEach(walker => {
                        if (!walkerStats[walker]) {
                            walkerStats[walker] = { count: 0, distance: 0, duration: 0 };
                        }
                        walkerStats[walker].count += 1;
                        walkerStats[walker].distance += w.distance || 0;
                        walkerStats[walker].duration += w.duration || 0;
                    });
                });
                return {
                    count: filteredWalks.length,
                    totalDistance,
                    totalDuration,
                    mealCount,
                    pooCount,
                    avgDuration: filteredWalks.length > 0 ? totalDuration / filteredWalks.length : 0,
                    walkerStats
                };
            };

            const getEarnedBadges = () => {
                const totalCount = walks.length;
                const totalDistance = walks.reduce((sum, w) => sum + (w.distance || 0), 0);
                return badges.filter(badge => badge.condition(totalCount, totalDistance));
            };

            const getFirmnessEmoji = (firmness) => {
                const emojis = {
                    1: 'üíßüíß',
                    2: 'üíß',
                    3: '‚úÖ',
                    4: '‚ö†Ô∏è',
                    5: 'üî¥'
                };
                return emojis[firmness] || '‚úÖ';
            };

            if (loading) {
                return React.createElement('div', {
                    className: 'flex items-center justify-center min-h-screen'
                },
                    React.createElement('div', { className: 'text-lg' }, 'Ë™≠„ÅøËæº„Åø‰∏≠...')
                );
            }

            const stats = getStats(statsView);
            const earnedBadges = getEarnedBadges();
            const recentWalks = walks.slice(0, 20);
            const recentHealth = healthRecords.slice(0, 20);

            return React.createElement('div', { className: 'max-w-md mx-auto bg-white min-h-screen pb-20' },
                React.createElement('div', {
                    className: 'bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4'
                },
                    React.createElement('h1', { className: 'text-2xl font-bold' }, 'üêï Á¶è„Å®„ÅÑ„Å£„Åó„Çá')
                ),
                React.createElement('div', { className: 'flex border-b overflow-x-auto' },
                    React.createElement('button', {
                        onClick: () => handleTabChange('dashboard'),
                        className: `flex-shrink-0 px-4 py-3 ${activeTab === 'dashboard' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
                    }, '„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ'),
                    React.createElement('button', {
                        onClick: () => handleTabChange('walk'),
                        className: `flex-shrink-0 px-4 py-3 ${activeTab === 'walk' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
                    }, 'Êï£Ê≠©'),
                    React.createElement('button', {
                        onClick: () => handleTabChange('health'),
                        className: `flex-shrink-0 px-4 py-3 ${activeTab === 'health' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
                    }, '„Åä‰∏ñË©±'),
                    React.createElement('button', {
                        onClick: () => handleTabChange('stats'),
                        className: `flex-shrink-0 px-4 py-3 ${activeTab === 'stats' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
                    }, 'Áµ±Ë®à'),
                    React.createElement('button', {
                        onClick: () => handleTabChange('badges'),
                        className: `flex-shrink-0 px-4 py-3 ${activeTab === 'badges' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
                    }, '„Éê„ÉÉ„Ç∏'),
                    React.createElement('button', {
                        onClick: () => handleTabChange('settings'),
                        className: `flex-shrink-0 px-4 py-3 ${activeTab === 'settings' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
                    }, 'Ë®≠ÂÆö')
                ),

                activeTab === 'dashboard' && React.createElement('div', { className: 'p-4' },
                    React.createElement('div', {
                        className: 'bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-lg mb-4 shadow-sm'
                    },
                        React.createElement('h2', { className: 'text-xl font-bold mb-3' },
                            'üìä ' + getPeriodLabel('week')
                        ),
                        React.createElement('div', { className: 'grid grid-cols-5 gap-1' },
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'Êï£Ê≠©'),
                                React.createElement('p', { className: 'text-lg font-bold text-blue-600' },
                                    getStats('week').count,
                                    React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'Âõû')
                                )
                            ),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'Ë∑ùÈõ¢'),
                                React.createElement('p', { className: 'text-lg font-bold text-green-600' },
                                    (getStats('week').totalDistance / 1000).toFixed(1),
                                    React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'km')
                                )
                            ),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'ÊôÇÈñì'),
                                React.createElement('p', { className: 'text-lg font-bold text-purple-600' },
                                    getStats('week').totalDuration,
                                    React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'ÂàÜ')
                                )
                            ),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                React.createElement('p', { className: 'text-[10px] text-gray-600' }, '„ÅîÈ£Ø'),
                                React.createElement('p', { className: 'text-lg font-bold text-orange-600' },
                                    getStats('week').mealCount,
                                    React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'Âõû')
                                )
                            ),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'ÊéíÊ≥Ñ'),
                                React.createElement('p', { className: 'text-lg font-bold text-yellow-600' },
                                    getStats('week').pooCount,
                                    React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'Âõû')
                                )
                            )
                        )
                    ),
                    React.createElement('h3', { className: 'font-bold mb-2 text-lg flex items-center' },
                        React.createElement('span', { className: 'mr-2' }, 'üïí'), 'ÊúÄËøë„ÅÆË®òÈå≤'
                    ),
                    React.createElement('div', { className: 'space-y-3 max-h-96 overflow-y-auto pr-1' },
                        recentWalks.length === 0 && recentHealth.length === 0 ?
                            React.createElement('p', { className: 'text-center text-gray-500 mt-4' }, '„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì') :
                            [...recentWalks.map(walk => ({ ...walk, type: 'walk' })),
                            ...recentHealth.map(h => ({ ...h, type: h.type || 'health' }))]
                                .sort((a, b) => {
                                    const dateA = a.type === 'walk' ? a.startTime : a.date;
                                    const dateB = b.type === 'walk' ? b.startTime : b.date;
                                    return dateB - dateA;
                                })
                                .slice(0, 10)
                                .map(item => item.type === 'walk' ?
                                    React.createElement('div', {
                                        key: 'w-' + item.id,
                                        className: 'border rounded-lg p-3 bg-white shadow-sm'
                                    },
                                        React.createElement('div', {
                                            className: 'flex justify-between items-start mb-2'
                                        },
                                            // Â∑¶ÂÅ¥„Ç≥„É≥„ÉÜ„Éä
                                            React.createElement('div', null,
                                                // 1. „Çø„Ç§„Éà„É´ + ÂêçÂâç
                                                React.createElement('p', { className: 'font-bold text-lg' },
                                                    'üö∂ Êï£Ê≠© (' + (Array.isArray(item.walkers) ? item.walkers.join(', ') : item.walkers) + ')'
                                                )
                                            ),
                                            // Âè≥ÂÅ¥„Ç≥„É≥„ÉÜ„ÉäÔºàÊó•‰ªò„ÉªÊôÇÈñì„ÉªË∑ùÈõ¢„ÉªÂ§©Ê∞óÔºâ
                                            React.createElement('div', { className: 'text-right flex flex-col items-end pl-2' },
                                                React.createElement('div', { className: 'text-xs text-gray-500 font-bold' }, formatDate(item.startTime)),
                                                React.createElement('div', { className: 'text-xs text-gray-500 font-bold' },
                                                    '‚è±Ô∏è' + item.duration + 'ÂàÜ üìç' + (item.distance / 1000).toFixed(2) + 'km'
                                                ),
                                                // „ÄêËøΩÂä†„ÉªÁßªÂãï„ÄëÂ§©Ê∞óÊÉÖÂ†±„ÇíË°®Á§∫
                                                item.weather && React.createElement('div', { className: 'text-xs text-gray-600 font-medium mt-1' },
                                                    `${getWeatherEmoji(item.weather.icon)} ${item.weather.temp}‚ÑÉ üí®${item.weather.wind}m`
                                                )
                                            )
                                        ),
                                        // „Ç≥„É≥„ÉÜ„É≥„ÉÑÔºà„Ç¢„Ç§„Ç≥„É≥„Éª„É°„É¢„ÉªÂÜôÁúüÔºâ
                                        React.createElement('div', null,
                                            item.memo && React.createElement('div', { className: 'text-sm text-gray-600 mb-1 bg-gray-50 p-1 rounded' }, item.memo),
                                            React.createElement('div', { className: 'flex items-center gap-2' },
                                                React.createElement('span', { className: 'text-xl' }, 'üêï'),
                                                React.createElement('div', { className: 'flex gap-1' },
                                                    item.pee && React.createElement('span', { className: 'text-3xl' }, 'üíß'),
                                                    item.poo && React.createElement('span', { className: 'text-3xl' }, 'üí©'),
                                                    item.water && React.createElement('span', { className: 'text-3xl' }, 'ü•§')
                                                )
                                            ),
                                            item.photos && item.photos.length > 0 &&
                                            React.createElement('div', { className: 'flex gap-1 mt-2 overflow-x-auto' },
                                                item.photos.map((url, i) => React.createElement('img', {
                                                    key: i, src: url,
                                                    className: 'h-16 w-16 object-cover rounded cursor-pointer border border-gray-200',
                                                    onClick: () => setViewingPhoto(url)
                                                }))
                                            )
                                        )
                                    ) :
                                // ...‰ª•Èôç„ÅØÊó¢Â≠ò„ÅÆ„Éò„É´„Çπ„Ç±„Ç¢„Ç´„Éº„ÉâÊèèÁîª„ÅÆ„Åæ„Åæ
                                    React.createElement('div', {
                                        key: 'h-' + item.id,
                                        className: 'border rounded-lg p-3 bg-white shadow-sm'
                                    },
                                        React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                                            // Â∑¶‰∏ä
                                            React.createElement('div', null,
                                                React.createElement('p', { className: 'font-bold text-lg' },
                                                    (item.type === 'hospital' ? 'üè• ÁóÖÈô¢' :
                                                        item.type === 'grooming' ? '‚úÇÔ∏è Êï£È´™' :
                                                            item.type === 'bath' ? 'üõÅ ÂÖ•Êµ¥' :
                                                                item.type === 'food' ? 'ü•£ „ÅîÈ£Ø' :
                                                                    item.type === 'excretion' ? 'üí© ÊéíÊ≥Ñ' : 'üíä Ëñ¨') +
                                                    ' (' + item.walker + ')'
                                                )
                                            ),
                                            // Âè≥‰∏äÔºàÊó•ÊôÇÔºâ
                                            React.createElement('div', { className: 'text-right' },
                                                React.createElement('p', { className: 'text-xs text-gray-500 font-bold whitespace-nowrap' },
                                                    (item.type === 'excretion' || item.type === 'hospital' || item.type === 'food') ? formatDate(item.date) : formatDateOnly(item.date)
                                                )
                                            )
                                        ),
                                        // Ë©≥Á¥∞ÊÉÖÂ†±
                                        React.createElement('div', { className: 'mb-2' },
                                            item.hospitalName && React.createElement('p', { className: 'text-sm' }, 'üè• ' + item.hospitalName),
                                            item.medicineType && React.createElement('p', { className: 'text-sm text-blue-600' }, 'üíä ' + item.medicineType),
                                            item.type === 'excretion' && item.pooFirmness &&
                                            React.createElement('p', { className: 'text-sm' }, 'Á°¨„Åï: ' + getFirmnessEmoji(item.pooFirmness)),
                                            item.type === 'food' && item.foodAmount &&
                                            React.createElement('p', { className: 'text-sm' }, 'ÊÆãÈáè: ' + (['', 'Á©∫„Å£„ÅΩ', 'Â∞ë„Åó', 'ÊôÆÈÄö', 'Â§ö„ÇÅ', 'Ê∫ÄÊùØ'][item.foodAmount] || 'ÊôÆÈÄö') + ` (${item.foodAmount}/5)`),
                                            item.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-1' }, item.memo)
                                        )
                                    )
                                )
                    )
                ),

                activeTab === 'walk' && React.createElement('div', { className: 'p-4' },
                    !isWalking ? React.createElement('div', { className: 'space-y-4' },
                        React.createElement('div', null,
                            React.createElement('label', {
                                className: 'block text-sm font-medium mb-2'
                            }, 'Êï£Ê≠©ËÄÖ (ÊúÄÂ§ß10‰∫∫)'),
                            React.createElement('div', { className: 'space-y-2' },
                                walkers.map(w => React.createElement('label', {
                                    key: w.id,
                                    className: 'flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50'
                                },
                                    React.createElement('input', {
                                        type: 'checkbox',
                                        checked: selectedWalkers.includes(w.name),
                                        onChange: () => toggleWalker(w.name),
                                        className: 'mr-2 w-5 h-5'
                                    }),
                                    React.createElement('span', null, w.name)
                                ))
                            ),
                            selectedWalkers.length > 0 && React.createElement('p', {
                                className: 'text-sm text-gray-600 mt-2'
                            }, 'ÈÅ∏Êäû‰∏≠: ' + selectedWalkers.join(', '))
                        ),
                        React.createElement('button', {
                            onClick: startWalk,
                            className: 'w-full bg-green-500 text-white py-4 rounded-lg text-xl font-bold hover:bg-green-600 shadow-md transition-all'
                        }, 'üö∂ Êï£Ê≠©ÈñãÂßã'),
                        React.createElement('hr', { className: 'my-6' }),
                        React.createElement('h3', { className: 'font-bold mb-3' }, 'Êï£Ê≠©„Åó„Åü„Çà'),
                        React.createElement('div', { className: 'space-y-3' },
                            walks.length === 0 ?
                                React.createElement('p', { className: 'text-center text-gray-500 mt-4' }, '„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì') :
                                walks.map(walk => React.createElement('div', {
                                    key: walk.id,
                                    className: 'border rounded-lg p-3 bg-white shadow-sm'
                                },
                                    React.createElement('div', {
                                        className: 'flex justify-between items-start mb-2'
                                    },
                                        // Â∑¶ÂÅ¥„Ç≥„É≥„ÉÜ„ÉäÔºà„Çø„Ç§„Éà„É´Ôºâ
                                        React.createElement('div', null,
                                            React.createElement('p', { className: 'font-bold text-lg' },
                                                'üö∂ Êï£Ê≠© (' + (Array.isArray(walk.walkers) ? walk.walkers.join(', ') : (walk.walkers || walk.walker || 'undefined')) + ')'
                                            )
                                        ),
                                        // Âè≥ÂÅ¥„Ç≥„É≥„ÉÜ„ÉäÔºàÊó•‰ªò„ÉªË∑ùÈõ¢„ÉªÂ§©Ê∞óÔºâ
                                        React.createElement('div', { className: 'text-right flex flex-col items-end pl-2' },
                                            React.createElement('div', { className: 'text-xs text-gray-500 font-bold' }, formatDate(walk.startTime)),
                                            React.createElement('div', { className: 'text-xs text-gray-500 font-bold' },
                                                '‚è±Ô∏è' + walk.duration + 'ÂàÜ üìç' + (walk.distance / 1000).toFixed(2) + 'km'
                                            ),
                                            walk.weather && React.createElement('div', { className: 'text-xs text-gray-600 font-medium mt-1' },
                                                `${getWeatherEmoji(walk.weather.icon)} ${walk.weather.temp}‚ÑÉ üí®${walk.weather.wind}m`
                                            )
                                        )
                                    ),
                                    // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç®„É™„Ç¢
                                    React.createElement('div', null,
                                        walk.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-2 border-t pt-2' }, walk.memo),

                                        // „ÄêÂ§âÊõ¥ÁÆáÊâÄ„Äë„Ç¢„Ç§„Ç≥„É≥„Å®Êìç‰Ωú„Éú„Çø„É≥„Çí1Ë°å„Å´„Åæ„Å®„ÇÅ„Çã
                                        React.createElement('div', { className: 'flex justify-between items-center mt-2' },
                                            // Â∑¶ÂÅ¥Ôºö„Çπ„ÉÜ„Éº„Çø„Çπ„Ç¢„Ç§„Ç≥„É≥ÔºàÁä¨„ÄÅÊéíÊ≥Ñ„ÄÅÊ∞¥Ôºâ
                                            React.createElement('div', { className: 'flex items-center gap-2' },
                                                React.createElement('span', { className: 'text-xl' }, 'üêï'),
                                                React.createElement('div', { className: 'flex gap-1' },
                                                    walk.pee && React.createElement('span', { className: 'text-3xl' }, 'üíß'),
                                                    walk.poo && React.createElement('span', { className: 'text-3xl' }, 'üí©'),
                                                    walk.water && React.createElement('span', { className: 'text-3xl' }, 'ü•§')
                                                )
                                            ),

                                            // Âè≥ÂÅ¥ÔºöÊìç‰Ωú„Éú„Çø„É≥ÔºàÂú∞Âõ≥„ÄÅÁ∑®ÈõÜ„ÄÅÂâäÈô§Ôºâ„Çí„Åì„Åì„Å∏ÁßªÂãï
                                            React.createElement('div', { className: 'flex gap-2' },
                                                walk.positions && walk.positions.length > 0 &&
                                                React.createElement('button', {
                                                    onClick: () => setShowMap(walk.positions),
                                                    className: 'p-2 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg text-xl transition-colors',
                                                    title: 'Âú∞Âõ≥„ÇíË¶ã„Çã'
                                                }, 'üó∫Ô∏è'),
                                                React.createElement('button', {
                                                    onClick: () => setEditingWalk(walk),
                                                    className: 'p-2 text-gray-600 bg-gray-50 hover:bg-gray-100 rounded-lg text-xl transition-colors',
                                                    title: 'Á∑®ÈõÜ'
                                                }, '‚úèÔ∏è'),
                                                React.createElement('button', {
                                                    onClick: () => deleteWalk(walk.id),
                                                    className: 'p-2 text-red-600 bg-red-50 hover:bg-red-100 rounded-lg text-xl transition-colors',
                                                    title: 'ÂâäÈô§'
                                                }, 'üóëÔ∏è')
                                            )
                                        ),

                                        // ÂÜôÁúü„É™„Çπ„ÉàÔºà‰∏ÄÁï™‰∏ã„Å∏Ôºâ
                                        walk.photos && walk.photos.length > 0 &&
                                        React.createElement('div', { className: 'grid grid-cols-4 gap-1 mt-3' },
                                            walk.photos.map((url, i) => React.createElement('img', {
                                                key: i, src: url,
                                                className: 'w-full h-16 object-cover rounded cursor-pointer',
                                                onClick: () => setViewingPhoto(url)
                                            }))
                                        )
                                    )
                                ))
                        )
                    ) : React.createElement('div', { className: 'space-y-4' },
                        React.createElement('div', { className: 'bg-blue-50 p-4 rounded-lg border-2 border-blue-200' },
                            React.createElement('p', { className: 'text-sm text-gray-600 mb-1' }, 'üë• Êï£Ê≠©ËÄÖ: ' + currentWalk?.walkers.join(', ')),
                            React.createElement('p', { className: 'text-lg font-bold text-blue-700 mb-1' },
                                '‚è±Ô∏è ÁµåÈÅéÊôÇÈñì: ' + formatTimer(currentWalk?.startTime)
                            ),
                            React.createElement('p', { className: 'text-sm text-gray-600 mb-1' },
                                'üìç Ë∑ùÈõ¢: ' + (calculateTotalDistance(currentWalk?.positions || []) / 1000).toFixed(2) + 'km'
                            ),
                            currentWalk?.positions && currentWalk.positions.length > 0 &&
                            React.createElement('p', { className: 'text-xs text-gray-500' },
                                'üéØ GPSÁ≤æÂ∫¶: ' + (currentWalk.positions[currentWalk.positions.length - 1]?.accuracy?.toFixed(0) || 'Ê∏¨ÂÆö‰∏≠') + 'm'
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'Ë®òÈå≤'),
                            React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                                React.createElement('button', {
                                    onClick: () => setCurrentWalk({ ...currentWalk, pee: !currentWalk.pee }),
                                    className: `py-3 rounded-lg border-2 font-bold ${currentWalk?.pee ? 'bg-yellow-100 border-yellow-500' : 'border-gray-300'}`
                                }, 'üíß „Åä„Åó„Å£„Åì'),
                                React.createElement('button', {
                                    onClick: () => setCurrentWalk({ ...currentWalk, poo: !currentWalk.poo }),
                                    className: `py-3 rounded-lg border-2 font-bold ${currentWalk?.poo ? 'bg-amber-100 border-amber-500' : 'border-gray-300'}`
                                }, 'üí© „ÅÜ„Çì„Å°'),
                                React.createElement('button', {
                                    onClick: () => setCurrentWalk({ ...currentWalk, water: !currentWalk.water }),
                                    className: `py-3 rounded-lg border-2 font-bold ${currentWalk?.water ? 'bg-blue-100 border-blue-500' : 'border-gray-300'}`
                                }, 'üíß Ê∞¥')
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ÂÜôÁúü (ÊúÄÂ§ß4Êûö)'),
                            React.createElement('div', { className: 'grid grid-cols-4 gap-2 mb-2' },
                                photos.map((url, i) => React.createElement('div', { key: i, className: 'relative' },
                                    React.createElement('img', { src: url, className: 'w-full h-20 object-cover rounded' }),
                                    React.createElement('button', {
                                        onClick: () => removePhoto(i),
                                        className: 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 text-xs'
                                    }, '√ó')
                                ))
                            ),
                            photos.length < 4 && React.createElement('input', {
                                type: 'file', accept: 'image/*', multiple: true, onChange: handlePhotoUpload,
                                disabled: uploadingPhotos, className: 'w-full text-sm'
                            }),
                            uploadingPhotos && React.createElement('p', { className: 'text-sm text-gray-500' }, '„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠...')
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, '„É°„É¢'),
                            React.createElement('textarea', {
                                value: currentWalk?.memo || '',
                                onChange: (e) => setCurrentWalk({ ...currentWalk, memo: e.target.value }),
                                className: 'w-full p-2 border rounded-lg',
                                rows: 3,
                                placeholder: 'Ê∞ó„Å•„ÅÑ„Åü„Åì„Å®„Çí„É°„É¢...'
                            })
                        ),
                        React.createElement('button', {
                            onClick: () => { if (confirm('Êï£Ê≠©„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü')) endWalk(); },
                            disabled: uploadingPhotos, // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠„ÅØÁÑ°ÂäπÂåñ
                            className: `w-full py-4 rounded-lg text-xl font-bold shadow-md ${uploadingPhotos ? 'bg-gray-400 cursor-not-allowed' : 'bg-red-500 text-white hover:bg-red-600'}`
                        }, uploadingPhotos ? 'ÂÜôÁúü„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠...' : 'üèÅ Êï£Ê≠©ÁµÇ‰∫Ü')
                    )
                ),

                activeTab === 'health' && React.createElement('div', { className: 'p-4' },
                    !showHealthForm ? React.createElement('div', null,
                        React.createElement('div', { className: 'grid grid-cols-3 gap-2 mb-6' },
                            React.createElement('button', {
                                onClick: () => initHealthForm('excretion', null),
                                className: 'bg-yellow-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm'
                            }, React.createElement('span', { className: 'text-2xl mb-1' }, 'üí©'), React.createElement('span', { className: 'text-xs font-bold' }, 'ÊéíÊ≥Ñ')),
                            React.createElement('button', {
                                onClick: () => initHealthForm('food', null),
                                className: 'bg-orange-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm'
                            }, React.createElement('span', { className: 'text-2xl mb-1' }, 'ü•£'), React.createElement('span', { className: 'text-xs font-bold' }, '„ÅîÈ£Ø')),
                            React.createElement('button', {
                                onClick: () => initHealthForm('medicine', null),
                                className: 'bg-green-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm'
                            }, React.createElement('span', { className: 'text-2xl mb-1' }, 'üíä'), React.createElement('span', { className: 'text-xs font-bold' }, 'Ëñ¨')),
                            React.createElement('button', {
                                onClick: () => initHealthForm('bath', null),
                                className: 'bg-blue-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm'
                            }, React.createElement('span', { className: 'text-2xl mb-1' }, 'üõÅ'), React.createElement('span', { className: 'text-xs font-bold' }, 'ÂÖ•Êµ¥')),
                            React.createElement('button', {
                                onClick: () => initHealthForm('grooming', null),
                                className: 'bg-pink-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm'
                            }, React.createElement('span', { className: 'text-2xl mb-1' }, '‚úÇÔ∏è'), React.createElement('span', { className: 'text-xs font-bold' }, 'Êï£È´™')),
                            React.createElement('button', {
                                onClick: () => initHealthForm('hospital', null),
                                className: 'bg-red-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm'
                            }, React.createElement('span', { className: 'text-2xl mb-1' }, 'üè•'), React.createElement('span', { className: 'text-xs font-bold' }, 'ÁóÖÈô¢'))
                        ),
                        React.createElement('h3', { className: 'font-bold mb-3' }, '„Åä‰∏ñË©±„Åó„Åü„Çà'),
                        React.createElement('div', { className: 'space-y-3' },
                            healthRecords.length === 0 ?
                                React.createElement('p', { className: 'text-center text-gray-500 mt-4' }, 'Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì') :
                                healthRecords.map(record => React.createElement('div', {
                                    key: record.id, className: 'border rounded-lg p-3 bg-white shadow-sm'
                                },
                                    React.createElement('div', { className: 'flex justify-between items-start' },
                                        React.createElement('div', { className: 'flex-1' },
                                            React.createElement('p', { className: 'font-bold text-lg' },
                                                (record.type === 'hospital' ? 'üè• ÁóÖÈô¢' :
                                                    record.type === 'grooming' ? '‚úÇÔ∏è Êï£È´™' :
                                                        record.type === 'bath' ? 'üõÅ ÂÖ•Êµ¥' :
                                                            record.type === 'food' ? 'ü•£ „ÅîÈ£Ø' :
                                                                record.type === 'excretion' ? 'üí© ÊéíÊ≥Ñ' : 'üíä Ëñ¨') +
                                                ' (' + record.walker + ')'
                                            ),
                                            // Ë©≥Á¥∞ÊÉÖÂ†±
                                            React.createElement('div', { className: 'mt-1' },
                                                record.hospitalName && React.createElement('p', { className: 'text-sm' }, 'üè• ' + record.hospitalName),
                                                record.medicineType && React.createElement('p', { className: 'text-sm text-blue-600' }, 'üíä ' + record.medicineType),
                                                record.type === 'excretion' && record.pooFirmness &&
                                                React.createElement('p', { className: 'text-sm' }, 'Á°¨„Åï: ' + getFirmnessEmoji(record.pooFirmness)),
                                                record.type === 'food' && record.foodAmount &&
                                                React.createElement('p', { className: 'text-sm' }, 'ÊÆãÈáè: ' + (['', 'Á©∫„Å£„ÅΩ', 'Â∞ë„Åó', 'ÊôÆÈÄö', 'Â§ö„ÇÅ', 'Ê∫ÄÊùØ'][record.foodAmount] || 'ÊôÆÈÄö') + ` (${record.foodAmount}/5)`),
                                                record.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-1' }, record.memo)
                                            )
                                        ),
                                        React.createElement('div', { className: 'text-right flex flex-col justify-between items-end gap-2' },
                                            React.createElement('p', { className: 'text-xs text-gray-500 font-bold whitespace-nowrap' },
                                                (record.type === 'excretion' || record.type === 'hospital' || record.type === 'food') ? formatDate(record.date) : formatDateOnly(record.date)
                                            ),
                                            React.createElement('div', { className: 'flex gap-2' },
                                                React.createElement('button', {
                                                    onClick: () => initHealthForm(record.type, record),
                                                    className: 'text-blue-500 text-xs font-bold border border-blue-200 px-2 py-1 rounded'
                                                }, 'Á∑®ÈõÜ'),
                                                React.createElement('button', {
                                                    onClick: () => deleteHealthRecord(record.id),
                                                    className: 'text-red-500 text-xs px-2 py-1'
                                                }, 'ÂâäÈô§')
                                            )
                                        )
                                    )
                                ))
                        )
                    ) : React.createElement(HealthForm, {
                        type: healthType,
                        walkers: walkers,
                        formData: healthFormData,
                        onChange: setHealthFormData,
                        onSave: saveHealthRecord,
                        onCancel: () => { setShowHealthForm(false); setEditingHealth(null); }
                    })
                ),

                activeTab === 'stats' && React.createElement('div', { className: 'p-4' },
                    React.createElement('div', { className: 'flex gap-2 mb-4 overflow-x-auto' },
                        ['week', 'month', 'year', 'all'].map(v => React.createElement('button', {
                            key: v, onClick: () => setStatsView(v),
                            className: `flex-shrink-0 px-4 py-2 rounded text-sm font-bold ${statsView === v ? 'bg-blue-500 text-white shadow' : 'bg-gray-200'}`
                        }, v === 'week' ? '‰ªäÈÄ±' : v === 'month' ? '‰ªäÊúà' : v === 'year' ? '‰ªäÂπ¥' : 'ÂÖ®ÊúüÈñì'))
                    ),
                    React.createElement('div', { className: 'space-y-4' },
                        React.createElement('div', { className: 'bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-lg shadow-sm border border-blue-200' },
                            React.createElement('h3', { className: 'font-bold mb-2' }, 'üìä ' + getPeriodLabel(statsView)),
                            React.createElement('div', { className: 'grid grid-cols-5 gap-1' },
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                    React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'Êï£Ê≠©'),
                                    React.createElement('p', { className: 'text-lg font-bold text-blue-600' },
                                        getStats(statsView).count,
                                        React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'Âõû')
                                    )
                                ),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                    React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'Ë∑ùÈõ¢'),
                                    React.createElement('p', { className: 'text-lg font-bold text-green-600' },
                                        (getStats(statsView).totalDistance / 1000).toFixed(1),
                                        React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'km')
                                    )
                                ),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                    React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'ÊôÇÈñì'),
                                    React.createElement('p', { className: 'text-lg font-bold text-purple-600' },
                                        getStats(statsView).totalDuration,
                                        React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'ÂàÜ')
                                    )
                                ),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                    React.createElement('p', { className: 'text-[10px] text-gray-600' }, '„ÅîÈ£Ø'),
                                    React.createElement('p', { className: 'text-lg font-bold text-orange-600' },
                                        getStats(statsView).mealCount,
                                        React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'Âõû')
                                    )
                                ),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' },
                                    React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'ÊéíÊ≥Ñ'),
                                    React.createElement('p', { className: 'text-lg font-bold text-yellow-600' },
                                        getStats(statsView).pooCount,
                                        React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'Âõû')
                                    )
                                )
                            )
                        )
                    )
                ),

                activeTab === 'badges' && React.createElement('div', { className: 'p-4' },
                    React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'üèÜ ÂÆüÁ∏æ„Éª„Éê„ÉÉ„Ç∏'),
                    React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                        badges.map(badge => {
                            const earned = earnedBadges.find(b => b.id === badge.id);
                            return React.createElement('div', {
                                key: badge.id,
                                className: `p-4 rounded-lg text-center ${earned ? 'bg-gradient-to-br from-yellow-50 to-orange-100 border-2 border-yellow-400 shadow-sm' : 'bg-gray-100 opacity-50'}`
                            },
                                React.createElement('div', { className: 'text-4xl mb-2' }, badge.icon),
                                React.createElement('p', { className: 'font-bold text-sm' }, badge.name),
                                earned && React.createElement('p', { className: 'text-xs text-green-600 mt-1 font-bold' }, '‚úì Áç≤ÂæóÊ∏à„Åø')
                            );
                        })
                    )
                ),

                activeTab === 'settings' && React.createElement('div', { className: 'p-4' },
                    React.createElement('h2', { className: 'text-xl font-bold mb-4 flex items-center' },
                        React.createElement('span', { className: 'mr-2' }, 'üè†'), 'ËçíÊú®ÂÆ∂'
                    ),
                    React.createElement('div', { className: 'space-y-2 mb-4' },
                        walkers.map(w => React.createElement('div', {
                            key: w.id, className: 'flex items-center justify-between p-3 border rounded-lg bg-white shadow-sm'
                        },
                            React.createElement('span', { className: 'font-medium' }, w.name),
                            React.createElement('button', { onClick: () => deleteWalker(w.id), className: 'text-red-500 text-sm font-bold' }, 'ÂâäÈô§')
                        ))
                    ),
                    !showAddWalker ? React.createElement('button', {
                        onClick: () => setShowAddWalker(true),
                        className: 'w-full bg-blue-500 text-white py-3 rounded-lg font-bold shadow-md'
                    }, '+ „É°„É≥„Éê„Éº„ÇíËøΩÂä†') : React.createElement('div', { className: 'space-y-2 bg-gray-50 p-4 rounded-lg' },
                        React.createElement('input', {
                            type: 'text', value: newWalkerName, onChange: (e) => setNewWalkerName(e.target.value),
                            placeholder: 'ÂêçÂâç„ÇíÂÖ•Âäõ', className: 'w-full p-2 border rounded'
                        }),
                        React.createElement('div', { className: 'flex gap-2' },
                            React.createElement('button', { onClick: addWalker, className: 'flex-1 bg-green-500 text-white py-2 rounded font-bold' }, 'ËøΩÂä†'),
                            React.createElement('button', { onClick: () => { setShowAddWalker(false); setNewWalkerName(''); }, className: 'flex-1 bg-gray-300 py-2 rounded' }, '„Ç≠„É£„É≥„Çª„É´')
                        )
                    )
                ),

                React.createElement('div', {
                    className: 'fixed bottom-0 left-0 right-0 bg-gray-100 border-t p-2 text-center'
                },
                    React.createElement('p', { className: 'text-xs text-gray-500 font-medium' }, 'Á¶è„Å®„ÅÑ„Å£„Åó„Çá ' + APP_VERSION)
                ),

                editingWalk && React.createElement(WalkEditForm, {
                    walk: editingWalk, walkers: walkers,
                    onSave: (data) => updateWalk(editingWalk.id, data),
                    onCancel: () => setEditingWalk(null)
                }),

                showMap && React.createElement(MapView, {
                    positions: showMap, onClose: () => setShowMap(null)
                }),

                // ÂÜôÁúüÊã°Â§ß„Éì„É•„Éº„ÉØ„ÉºÔºàviewingPhoto„Åå„Çª„ÉÉ„Éà„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„ÅøË°®Á§∫Ôºâ
                viewingPhoto && React.createElement(PhotoViewer, {
                    src: viewingPhoto,
                    onClose: () => setViewingPhoto(null)
                })
            );
        }

        ReactDOM.render(React.createElement(App), document.getElementById('app'));
    </script>
</body>

</html>