<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦ã¨ã„ã£ã—ã‚‡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body class="bg-gray-100">
    <div id="app"></div>
    <script>
        // â˜…ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°
        const APP_VERSION = 'v2.1.0';

        const firebaseConfig = {
            apiKey: "AIzaSyAqGO0-RnJAfQqsIunx35ZuAGc85cFD-lA",
            authDomain: "walking-36c5a.firebaseapp.com",
            projectId: "walking-36c5a",
            storageBucket: "walking-36c5a.firebasestorage.app",
            messagingSenderId: "457304106244",
            appId: "1:457304106244:web:3bcb8df4d4a3b27a971c51"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const functions = firebase.app().functions('asia-northeast1');
        const { useState, useEffect, useRef } = React;

        const badges = [
            { id: 'first', name: 'åˆã‚ã¦ã®æ•£æ­©', icon: 'ğŸ‰', condition: (c) => c >= 1 },
            { id: 'ten', name: 'æ•£æ­©10å›', icon: 'ğŸŒŸ', condition: (c) => c >= 10 },
            { id: 'fifty', name: 'æ•£æ­©50å›', icon: 'â­', condition: (c) => c >= 50 },
            { id: 'hundred', name: 'æ•£æ­©100å›', icon: 'ğŸ‘‘', condition: (c) => c >= 100 },
            { id: 'distance10', name: 'åˆè¨ˆ10km', icon: 'ğŸƒ', condition: (c, d) => d >= 10000 },
            { id: 'distance50', name: 'åˆè¨ˆ50km', icon: 'ğŸš€', condition: (c, d) => d >= 50000 },
            { id: 'distance100', name: 'åˆè¨ˆ100km', icon: 'ğŸ–ï¸', condition: (c, d) => d >= 100000 }
        ];

        const WEATHER_API_KEY = "ba80598060806c2e4741766d34286357";

        const fetchWeatherData = async (lat, lng) => {
            try {
                if (!WEATHER_API_KEY) return null;
                const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${WEATHER_API_KEY}&units=metric&lang=ja`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Weather API Error');
                const data = await response.json();
                return {
                    condition: data.weather[0].description,
                    icon: data.weather[0].icon,
                    temp: Math.round(data.main.temp * 10) / 10,
                    wind: Math.round(data.wind.speed * 10) / 10
                };
            } catch (error) {
                console.warn("å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€å‡¦ç†ã‚’ç¶™ç¶šã—ã¾ã™:", error);
                return null;
            }
        };

        const getWeatherEmoji = (iconCode) => {
            if (!iconCode) return 'ğŸŒ¤ï¸';
            const map = {
                '01': 'â˜€ï¸', '02': 'â›…', '03': 'â˜ï¸', '04': 'â˜ï¸',
                '09': 'ğŸŒ§ï¸', '10': 'â˜”', '11': 'âš¡', '13': 'â›„', '50': 'ğŸŒ«ï¸',
            };
            const code = iconCode.substring(0, 2);
            return map[code] || 'ğŸŒ¤ï¸';
        };

        const getTodayDateString = () => {
            const d = new Date();
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        const toLocalISOString = (date) => {
            if (!date) return '';
            const d = new Date(date);
            const pad = (n) => n.toString().padStart(2, '0');
            return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
        };

        const compressImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 1200;
                        const scaleSize = img.width > MAX_WIDTH ? MAX_WIDTH / img.width : 1;
                        canvas.width = img.width * scaleSize;
                        canvas.height = img.height * scaleSize;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        canvas.toBlob((blob) => {
                            if (blob) {
                                resolve(blob);
                            } else {
                                reject(new Error('Image compression failed'));
                            }
                        }, 'image/jpeg', 0.7);
                    };
                    img.onerror = (error) => reject(error);
                };
                reader.onerror = (error) => reject(error);
            });
        };

        function getMonday(d) {
            const date = new Date(d);
            const day = date.getDay();
            const diff = date.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(date.setDate(diff));
        }

        function getPeriodLabel(period) {
            const now = new Date();
            if (period === 'week') {
                const monday = getMonday(now);
                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);
                return `ä»Šé€± (${monday.getMonth() + 1}/${monday.getDate()}ã€œ${sunday.getMonth() + 1}/${sunday.getDate()})`;
            } else if (period === 'month') {
                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                return `ä»Šæœˆ (${firstDay.getMonth() + 1}/${firstDay.getDate()}ã€œ${lastDay.getMonth() + 1}/${lastDay.getDate()})`;
            } else if (period === 'year') {
                return `ä»Šå¹´ (${now.getFullYear()}å¹´)`;
            } else {
                return 'å…¨æœŸé–“';
            }
        }

        function PhotoViewer({ src, onClose }) {
            const [scale, setScale] = useState(1);
            useEffect(() => {
                document.body.style.overflow = 'hidden';
                return () => document.body.style.overflow = 'auto';
            }, []);
            return React.createElement('div', {
                className: 'fixed inset-0 bg-black z-[60] flex items-center justify-center overflow-hidden',
                onClick: onClose
            },
                React.createElement('div', { className: 'absolute top-4 right-4 z-10 flex gap-4' },
                    React.createElement('button', {
                        className: 'bg-gray-800 text-white p-3 rounded-full opacity-80 hover:opacity-100',
                        onClick: (e) => { e.stopPropagation(); setScale(s => Math.min(s + 0.5, 3)); }
                    }, 'â•'),
                    React.createElement('button', {
                        className: 'bg-gray-800 text-white p-3 rounded-full opacity-80 hover:opacity-100',
                        onClick: (e) => { e.stopPropagation(); setScale(s => Math.max(s - 0.5, 1)); }
                    }, 'â–'),
                    React.createElement('button', {
                        className: 'bg-white text-black p-3 rounded-full opacity-80 hover:opacity-100 font-bold',
                        onClick: onClose
                    }, 'âœ•')
                ),
                React.createElement('img', {
                    src: src,
                    className: 'transition-transform duration-200 ease-out max-w-full max-h-full object-contain',
                    style: { transform: `scale(${scale})` },
                    onClick: (e) => e.stopPropagation()
                })
            );
        }

        function MapView({ positions, onClose }) {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            useEffect(() => {
                if (!positions || positions.length === 0 || !mapRef.current) return;
                if (!mapInstanceRef.current) {
                    mapInstanceRef.current = L.map(mapRef.current).setView([positions[0].lat, positions[0].lng], 15);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: 'Â© OpenStreetMap contributors'
                    }).addTo(mapInstanceRef.current);
                }
                const latLngs = positions.map(p => [p.lat, p.lng]);
                L.polyline(latLngs, { color: 'blue', weight: 4 }).addTo(mapInstanceRef.current);
                if (latLngs.length > 0) {
                    mapInstanceRef.current.fitBounds(latLngs);
                }
                return () => {
                    if (mapInstanceRef.current) {
                        mapInstanceRef.current.remove();
                        mapInstanceRef.current = null;
                    }
                };
            }, [positions]);
            return React.createElement('div', {
                className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4'
            },
                React.createElement('div', { className: 'bg-white rounded-lg w-full max-w-2xl' },
                    React.createElement('div', { className: 'p-4 border-b flex justify-between items-center' },
                        React.createElement('h3', { className: 'font-bold text-lg' }, 'ğŸ—ºï¸ æ•£æ­©ã‚³ãƒ¼ã‚¹'),
                        React.createElement('button', {
                            onClick: onClose,
                            className: 'text-gray-500 hover:text-gray-700 text-2xl'
                        }, 'Ã—')
                    ),
                    React.createElement('div', { ref: mapRef, className: 'w-full h-96' })
                )
            );
        }

        function WalkEditForm({ walk, walkers, onSave, onCancel }) {
            const [formData, setFormData] = useState({
                walkers: walk.walkers || [],
                startTime: walk.startTime ? toLocalISOString(walk.startTime) : '',
                endTime: walk.endTime ? toLocalISOString(walk.endTime) : '',
                pee: walk.pee || false,
                poo: walk.poo || false,
                water: walk.water || false,
                memo: walk.memo || '',
                photos: walk.photos || []
            });
            const [uploading, setUploading] = useState(false);

            const toggleWalker = (walkerName) => {
                setFormData(prev => ({
                    ...prev,
                    walkers: prev.walkers.includes(walkerName)
                        ? prev.walkers.filter(w => w !== walkerName)
                        : [...prev.walkers, walkerName]
                }));
            };

            const handlePhotoUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                setUploading(true);
                try {
                    const uploadPromises = files.map(async (file) => {
                        const compressedBlob = await compressImage(file);
                        const randomId = Math.random().toString(36).substring(7);
                        const fileName = file.name.split('.')[0] + '.jpg';
                        const ref = storage.ref(`walks/${Date.now()}_${randomId}_${fileName}`);
                        await ref.put(compressedBlob);
                        return await ref.getDownloadURL();
                    });
                    const newUrls = await Promise.all(uploadPromises);
                    setFormData(prev => ({ ...prev, photos: [...prev.photos, ...newUrls] }));
                } catch (err) {
                    alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
                } finally {
                    setUploading(false);
                    e.target.value = '';
                }
            };

            const removePhoto = (index) => {
                setFormData(prev => ({ ...prev, photos: prev.photos.filter((_, i) => i !== index) }));
            };

            const handleSubmit = () => {
                if (formData.walkers.length === 0) { alert('æ•£æ­©è€…ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
                const start = new Date(formData.startTime);
                const end = new Date(formData.endTime);
                if (isNaN(start.getTime()) || isNaN(end.getTime())) { alert('æ—¥æ™‚ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'); return; }
                if (end < start) { alert('çµ‚äº†æ™‚é–“ã¯é–‹å§‹æ™‚é–“ã‚ˆã‚Šå¾Œã«ã—ã¦ãã ã•ã„'); return; }
                const newDuration = Math.floor((end - start) / 60000);
                const saveData = {
                    ...formData,
                    startTime: firebase.firestore.Timestamp.fromDate(start),
                    endTime: firebase.firestore.Timestamp.fromDate(end),
                    duration: newDuration
                };
                onSave(saveData);
            };

            return React.createElement('div', {
                className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4'
            },
                React.createElement('div', { className: 'bg-white rounded-lg w-full max-w-md max-h-screen overflow-y-auto' },
                    React.createElement('div', { className: 'p-4' },
                        React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'æ•£æ­©è¨˜éŒ²ã‚’ç·¨é›†'),
                        React.createElement('div', { className: 'space-y-4' },
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æ—¥æ™‚'),
                                React.createElement('div', { className: 'grid grid-cols-2 gap-2' },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'text-xs text-gray-500' }, 'é–‹å§‹'),
                                        React.createElement('input', {
                                            type: 'datetime-local',
                                            value: formData.startTime,
                                            onChange: (e) => setFormData({ ...formData, startTime: e.target.value }),
                                            className: 'w-full p-2 border rounded text-sm'
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'text-xs text-gray-500' }, 'çµ‚äº†'),
                                        React.createElement('input', {
                                            type: 'datetime-local',
                                            value: formData.endTime,
                                            onChange: (e) => setFormData({ ...formData, endTime: e.target.value }),
                                            className: 'w-full p-2 border rounded text-sm'
                                        })
                                    )
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æ•£æ­©è€…'),
                                React.createElement('div', { className: 'space-y-2' },
                                    walkers.map(w => React.createElement('label', {
                                        key: w.id, className: 'flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50'
                                    },
                                        React.createElement('input', {
                                            type: 'checkbox', checked: formData.walkers.includes(w.name),
                                            onChange: () => toggleWalker(w.name), className: 'mr-2 w-5 h-5'
                                        }),
                                        React.createElement('span', null, w.name)
                                    ))
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'è¨˜éŒ²'),
                                React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                                    React.createElement('button', {
                                        onClick: () => setFormData({ ...formData, pee: !formData.pee }),
                                        type: 'button',
                                        className: `py-3 rounded-lg border-2 ${formData.pee ? 'bg-yellow-100 border-yellow-500' : 'border-gray-300'}`
                                    }, 'ğŸ’§ ãŠã—ã£ã“'),
                                    React.createElement('button', {
                                        onClick: () => setFormData({ ...formData, poo: !formData.poo }),
                                        type: 'button',
                                        className: `py-3 rounded-lg border-2 ${formData.poo ? 'bg-amber-100 border-amber-500' : 'border-gray-300'}`
                                    }, 'ğŸ’© ã†ã‚“ã¡'),
                                    React.createElement('button', {
                                        onClick: () => setFormData({ ...formData, water: !formData.water }),
                                        type: 'button',
                                        className: `py-3 rounded-lg border-2 ${formData.water ? 'bg-blue-100 border-blue-500' : 'border-gray-300'}`
                                    }, 'ğŸ’§ æ°´')
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'å†™çœŸ'),
                                React.createElement('div', { className: 'grid grid-cols-4 gap-2 mb-2' },
                                    formData.photos.map((url, i) => React.createElement('div', { key: i, className: 'relative' },
                                        React.createElement('img', { src: url, className: 'w-full h-16 object-cover rounded' }),
                                        React.createElement('button', {
                                            onClick: () => removePhoto(i),
                                            className: 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 text-xs'
                                        }, 'Ã—')
                                    ))
                                ),
                                React.createElement('input', {
                                    type: 'file', accept: 'image/*', multiple: true, onChange: handlePhotoUpload,
                                    disabled: uploading, className: 'w-full text-sm'
                                }),
                                uploading && React.createElement('p', { className: 'text-sm text-gray-500' }, 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...')
                            ),
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ãƒ¡ãƒ¢'),
                                React.createElement('textarea', {
                                    value: formData.memo, onChange: (e) => setFormData({ ...formData, memo: e.target.value }),
                                    className: 'w-full p-2 border rounded-lg', rows: 3
                                })
                            ),
                            React.createElement('div', { className: 'flex gap-2' },
                                React.createElement('button', { onClick: handleSubmit, className: 'flex-1 bg-blue-500 text-white py-2 rounded-lg' }, 'ä¿å­˜'),
                                React.createElement('button', { onClick: onCancel, className: 'flex-1 bg-gray-300 py-2 rounded-lg' }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
                            )
                        )
                    )
                )
            );
        }

        function HealthForm({ type, walkers, formData, onChange, onSave, onCancel }) {
            const [uploading, setUploading] = useState(false);

            const handleSubmit = () => {
                if (!formData.walker) { alert('æ‹…å½“è€…ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
                if (type === 'hospital' && !formData.hospitalName) { alert('ç—…é™¢åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
                if (type === 'grooming' && formData.groomedBy === 'shop' && !formData.shopName) { alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
                if (type === 'medicine' && !formData.medicineType) { alert('è–¬ã®ç¨®é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
                onSave(formData);
            };

            const handlePhotoUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                setUploading(true);
                try {
                    const uploadPromises = files.map(async (file) => {
                        const compressedBlob = await compressImage(file);
                        const randomId = Math.random().toString(36).substring(7);
                        const fileName = file.name.split('.')[0] + '.jpg';
                        const ref = storage.ref(`health/${Date.now()}_${randomId}_${fileName}`);
                        await ref.put(compressedBlob);
                        return await ref.getDownloadURL();
                    });
                    const newUrls = await Promise.all(uploadPromises);
                    onChange({ ...formData, photos: [...(formData.photos || []), ...newUrls] });
                } catch (err) {
                    alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
                } finally {
                    setUploading(false);
                    e.target.value = '';
                }
            };

            const removePhoto = (index) => {
                onChange({ ...formData, photos: (formData.photos || []).filter((_, i) => i !== index) });
            };

            const getFirmnessLabel = (value) => {
                const labels = { 1: 'ã¨ã¦ã‚‚ã‚„ã‚ã‚‰ã‹ã„', 2: 'ã‚„ã‚ã‚‰ã‹ã„', 3: 'æ™®é€š', 4: 'ç¡¬ã‚', 5: 'ç¡¬ã„' };
                return labels[value];
            };

            const getFoodAmountLabel = (value) => {
                const labels = { 1: 'ç©ºã£ã½', 2: 'å°‘ã—', 3: 'æ™®é€š', 4: 'å¤šã‚', 5: 'æº€æ¯' };
                return labels[value] + ` (${value}/5)`;
            };

            return React.createElement('div', { className: 'space-y-4 bg-white p-4 rounded-lg' },
                React.createElement('h3', { className: 'font-bold text-lg' },
                    (formData.id ? 'âœï¸ ç·¨é›†: ' : '') +
                    (type === 'hospital' ? 'ğŸ¥ ç—…é™¢è¨˜éŒ²' : type === 'grooming' ? 'âœ‚ï¸ æ•£é«ªè¨˜éŒ²' : type === 'bath' ? 'ğŸ› å…¥æµ´è¨˜éŒ²' : type === 'food' ? 'ğŸ¥£ ã”é£¯' : type === 'excretion' ? 'ğŸ’© æ’æ³„è¨˜éŒ²' : 'ğŸ’Š è–¬è¨˜éŒ²')
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'æ‹…å½“è€…'),
                    React.createElement('select', {
                        value: formData.walker, onChange: (e) => onChange({ ...formData, walker: e.target.value }),
                        className: 'w-full p-2 border rounded'
                    },
                        React.createElement('option', { value: '' }, 'æ‹…å½“è€…ã‚’é¸æŠ'),
                        walkers.map(w => React.createElement('option', { key: w.id, value: w.name }, w.name))
                    )
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'æ—¥ä»˜'),
                    React.createElement('input', {
                        type: 'date', value: formData.date,
                        onChange: (e) => onChange({ ...formData, date: e.target.value }),
                        className: 'w-full p-2 border rounded'
                    })
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'æ™‚åˆ»'),
                    React.createElement('input', {
                        type: 'time', value: formData.time,
                        onChange: (e) => onChange({ ...formData, time: e.target.value }),
                        className: 'w-full p-2 border rounded'
                    })
                ),
                type === 'hospital' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ç—…é™¢å'),
                    React.createElement('input', {
                        type: 'text', value: formData.hospitalName,
                        onChange: (e) => onChange({ ...formData, hospitalName: e.target.value }),
                        className: 'w-full p-2 border rounded', placeholder: 'ä¾‹: â—‹â—‹å‹•ç‰©ç—…é™¢'
                    }),
                    React.createElement('label', { className: 'block text-sm font-medium mb-1 mt-2' }, 'ç†ç”±'),
                    React.createElement('input', {
                        type: 'text', value: formData.reason,
                        onChange: (e) => onChange({ ...formData, reason: e.target.value }),
                        className: 'w-full p-2 border rounded', placeholder: 'ä¾‹: å®šæœŸæ¤œè¨º'
                    })
                ),
                type === 'grooming' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'å®Ÿæ–½å ´æ‰€'),
                    React.createElement('div', { className: 'space-y-2' },
                        React.createElement('label', { className: 'flex items-center' },
                            React.createElement('input', {
                                type: 'radio', name: 'groomedBy', value: 'walker',
                                checked: formData.groomedBy === 'walker',
                                onChange: (e) => onChange({ ...formData, groomedBy: e.target.value }),
                                className: 'mr-2'
                            }), 'è‡ªå®…'
                        ),
                        React.createElement('label', { className: 'flex items-center' },
                            React.createElement('input', {
                                type: 'radio', name: 'groomedBy', value: 'shop',
                                checked: formData.groomedBy === 'shop',
                                onChange: (e) => onChange({ ...formData, groomedBy: e.target.value }),
                                className: 'mr-2'
                            }), 'åº—èˆ—'
                        ),
                        formData.groomedBy === 'shop' && React.createElement('input', {
                            type: 'text', value: formData.shopName,
                            onChange: (e) => onChange({ ...formData, shopName: e.target.value }),
                            className: 'w-full p-2 border rounded ml-6', placeholder: 'åº—èˆ—åã‚’å…¥åŠ›'
                        })
                    )
                ),
                type === 'medicine' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'è–¬ã®ç¨®é¡'),
                    React.createElement('input', {
                        type: 'text', value: formData.medicineType,
                        onChange: (e) => onChange({ ...formData, medicineType: e.target.value }),
                        className: 'w-full p-2 border rounded', placeholder: 'ä¾‹: ãƒ•ã‚£ãƒ©ãƒªã‚¢äºˆé˜²è–¬'
                    }),
                    React.createElement('label', { className: 'flex items-center mt-2' },
                        React.createElement('input', {
                            type: 'checkbox', checked: formData.isVaccine,
                            onChange: (e) => onChange({ ...formData, isVaccine: e.target.checked }),
                            className: 'mr-2'
                        }), 'äºˆé˜²æ¥ç¨®'
                    )
                ),
                type === 'excretion' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' },
                        'ã†ã‚“ã¡ã®ç¡¬ã•: ' + getFirmnessLabel(formData.pooFirmness)
                    ),
                    React.createElement('input', {
                        type: 'range', min: 1, max: 5, value: formData.pooFirmness,
                        onChange: (e) => onChange({ ...formData, pooFirmness: parseInt(e.target.value) }),
                        className: 'w-full'
                    }),
                    React.createElement('div', { className: 'flex justify-between text-xs text-gray-500 mt-1' },
                        React.createElement('span', null, 'ã‚„ã‚ã‚‰ã‹ã„'), React.createElement('span', null, 'æ™®é€š'), React.createElement('span', null, 'ç¡¬ã„')
                    )
                ),
                type === 'food' && React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' },
                        'æ®‹é‡: ' + getFoodAmountLabel(formData.foodAmount || 3)
                    ),
                    React.createElement('input', {
                        type: 'range', min: 1, max: 5, value: formData.foodAmount || 3,
                        onChange: (e) => onChange({ ...formData, foodAmount: parseInt(e.target.value) }),
                        className: 'w-full'
                    }),
                    React.createElement('div', { className: 'flex justify-between text-xs text-gray-500 mt-1' },
                        React.createElement('span', null, 'ç©º'), React.createElement('span', null, 'æ™®é€š'), React.createElement('span', null, 'æº€æ¯')
                    )
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'å†™çœŸ (æœ€å¤§4æš)'),
                    React.createElement('div', { className: 'grid grid-cols-4 gap-2 mb-2' },
                        (formData.photos || []).map((url, i) => React.createElement('div', { key: i, className: 'relative' },
                            React.createElement('img', { src: url, className: 'w-full h-16 object-cover rounded' }),
                            React.createElement('button', {
                                onClick: () => removePhoto(i),
                                className: 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 text-xs'
                            }, 'Ã—')
                        ))
                    ),
                    React.createElement('input', {
                        type: 'file', accept: 'image/*', multiple: true, onChange: handlePhotoUpload,
                        disabled: uploading, className: 'w-full text-sm'
                    }),
                    uploading && React.createElement('p', { className: 'text-sm text-gray-500' }, 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...')
                ),
                React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ãƒ¡ãƒ¢'),
                    React.createElement('textarea', {
                        value: formData.memo, onChange: (e) => onChange({ ...formData, memo: e.target.value }),
                        className: 'w-full p-2 border rounded', rows: 3, placeholder: 'è©³ç´°ã‚’ãƒ¡ãƒ¢...'
                    })
                ),

                // â˜…LINEé€šçŸ¥ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
                React.createElement('div', { className: 'flex items-center mb-2' },
                    React.createElement('input', {
                        type: 'checkbox',
                        id: 'notify-check',
                        checked: formData.notify,
                        onChange: (e) => onChange({ ...formData, notify: e.target.checked }),
                        className: 'w-5 h-5 text-blue-600 rounded focus:ring-blue-500 mr-2'
                    }),
                    React.createElement('label', { htmlFor: 'notify-check', className: 'text-sm font-bold text-gray-700' }, 'LINEã§é€šçŸ¥ã™ã‚‹')
                ),

                React.createElement('div', { className: 'flex gap-2' },
                    React.createElement('button', { onClick: handleSubmit, className: 'flex-1 bg-blue-500 text-white py-2 rounded font-bold' }, 'ä¿å­˜'),
                    React.createElement('button', { onClick: onCancel, className: 'flex-1 bg-gray-300 py-2 rounded' }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
                )
            );
        }

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [isWalking, setIsWalking] = useState(false);
            const [currentWalk, setCurrentWalk] = useState(null);
            const [walks, setWalks] = useState([]);
            const [healthRecords, setHealthRecords] = useState([]);
            const [walkers, setWalkers] = useState([]);
            const [selectedWalkers, setSelectedWalkers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [newWalkerName, setNewWalkerName] = useState('');
            const [showAddWalker, setShowAddWalker] = useState(false);
            const [uploadingPhotos, setUploadingPhotos] = useState(false);
            const [photos, setPhotos] = useState([]);
            const [statsView, setStatsView] = useState('week');
            const [showHealthForm, setShowHealthForm] = useState(false);
            const [healthType, setHealthType] = useState('hospital');
            const [editingWalk, setEditingWalk] = useState(null);
            const [editingHealth, setEditingHealth] = useState(null);
            const [showMap, setShowMap] = useState(null);
            const [viewingPhoto, setViewingPhoto] = useState(null);
            const [now, setNow] = useState(new Date());
            const stationaryTimeRef = useRef(0);
            const lastPositionRef = useRef(null);
            const [showWalkSetup, setShowWalkSetup] = useState(false);

            const [healthFormData, setHealthFormData] = useState({});
            const [originalHealthData, setOriginalHealthData] = useState({});

            // â˜…ç›¸å¯¾æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ (24æ™‚é–“ä»¥å†…ãªã‚‰ã€Œâ—¯æ™‚é–“å‰ã€)
            const formatRelativeTime = (date) => {
                if (!date) return '';
                const d = new Date(date);
                const now = new Date();
                const diffMs = now - d;
                const diffHours = diffMs / (1000 * 60 * 60);

                if (diffHours < 24 && diffHours >= 0) {
                    if (diffHours < 1) {
                        const diffMins = Math.floor(diffMs / (1000 * 60));
                        return diffMins <= 0 ? 'ãŸã£ãŸä»Š' : `${diffMins}åˆ†å‰`;
                    }
                    return `${Math.floor(diffHours)}æ™‚é–“å‰`;
                }
                // 24æ™‚é–“ä»¥ä¸Šå‰ãªã‚‰é€šå¸¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
                const year = d.getFullYear().toString().slice(-2);
                return `${year}/${d.getMonth() + 1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`;
            };

            const formatDate = (date) => {
                if (!date) return '';
                const d = new Date(date);
                const year = d.getFullYear().toString().slice(-2);
                return `${year}/${d.getMonth() + 1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`;
            };

            useEffect(() => {
                let timer;
                if (isWalking) {
                    timer = setInterval(() => setNow(new Date()), 1000);
                }
                return () => clearInterval(timer);
            }, [isWalking]);

            useEffect(() => {
                const unsubscribe = db.collection('walkers').onSnapshot((snapshot) => {
                    const walkerList = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                    setWalkers(walkerList.sort((a, b) => a.order - b.order));
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const unsubscribe = db.collection('walks').orderBy('startTime', 'desc').onSnapshot((snapshot) => {
                    const walkList = snapshot.docs.map(doc => ({
                        ...doc.data(), id: doc.id,
                        startTime: doc.data().startTime?.toDate(),
                        endTime: doc.data().endTime?.toDate()
                    }));
                    setWalks(walkList);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const unsubscribe = db.collection('health').orderBy('date', 'desc').onSnapshot((snapshot) => {
                    const records = snapshot.docs.map(doc => ({
                        ...doc.data(), id: doc.id,
                        date: doc.data().date?.toDate()
                    }));
                    setHealthRecords(records);
                });
                return () => unsubscribe();
            }, []);

            const initHealthForm = (type, record) => {
                const initialData = {
                    id: record?.id || null,
                    type: record?.type || type,
                    date: record ? new Date(record.date).toISOString().split('T')[0] : getTodayDateString(),
                    time: record ? new Date(record.date).toTimeString().slice(0, 5) : new Date().toTimeString().slice(0, 5),
                    walker: record?.walker || '',
                    hospitalName: record?.hospitalName || '',
                    reason: record?.reason || '',
                    groomedBy: record?.groomedBy || 'walker',
                    shopName: record?.shopName || '',
                    medicineType: record?.medicineType || '',
                    isVaccine: record?.isVaccine || false,
                    pooFirmness: record?.pooFirmness || 3,
                    foodAmount: record?.foodAmount || 3,
                    memo: record?.memo || '',
                    photos: record?.photos || [],
                    notify: true // â˜…åˆæœŸå€¤ã¯é€šçŸ¥ON
                };
                setHealthFormData(initialData);
                setOriginalHealthData(initialData);
                setHealthType(type);
                if (record) setEditingHealth(record);
                setShowHealthForm(true);
                setShowWalkSetup(false);
            };

            const handleTabChange = (newTab) => {
                if (isWalking && newTab !== 'health') { alert('æ•£æ­©ä¸­ã§ã™ï¼'); return; }
                if (activeTab === 'health' && showHealthForm) {
                    const isDirty = JSON.stringify(healthFormData) !== JSON.stringify(originalHealthData);
                    if (isDirty) {
                        if (confirm('å¤‰æ›´å†…å®¹ã‚’ä¿å­˜ã—ã¾ã™ã‹ï¼Ÿ\nOK: ä¿å­˜ã—ã¦ç§»å‹•\nã‚­ãƒ£ãƒ³ã‚»ãƒ«: å¤‰æ›´ã‚’ç ´æ£„ã—ã¦ç§»å‹•')) {
                            saveHealthRecord(healthFormData);
                        } else { setShowHealthForm(false); setEditingHealth(null); }
                    } else { setShowHealthForm(false); setEditingHealth(null); }
                }
                setActiveTab(newTab);
            };

            const toggleWalker = (walkerName) => {
                setSelectedWalkers(prev => {
                    if (prev.includes(walkerName)) { return prev.filter(w => w !== walkerName); }
                    else {
                        if (prev.length >= 10) { alert('æ•£æ­©è€…ã¯æœ€å¤§10äººã¾ã§ã§ã™'); return prev; }
                        return [...prev, walkerName];
                    }
                });
            };

            const addWalker = async () => {
                if (!newWalkerName.trim()) return;
                await db.collection('walkers').add({ name: newWalkerName.trim(), order: walkers.length });
                setNewWalkerName(''); setShowAddWalker(false);
            };

            const deleteWalker = async (walkerId) => {
                if (confirm('ã“ã®æ•£æ­©è€…ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) { await db.collection('walkers').doc(walkerId).delete(); }
            };

            const handlePhotoUpload = async (e) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                if (photos.length + files.length > 4) { alert('å†™çœŸã¯æœ€å¤§4æšã¾ã§ã§ã™'); e.target.value = ''; return; }
                setUploadingPhotos(true);
                try {
                    const uploadPromises = files.map(async (file) => {
                        const compressedBlob = await compressImage(file);
                        const randomId = Math.random().toString(36).substring(7);
                        const fileName = file.name.split('.')[0] + '.jpg';
                        const ref = storage.ref(`walks/${Date.now()}_${randomId}_${fileName}`);
                        await ref.put(compressedBlob);
                        return await ref.getDownloadURL();
                    });
                    const uploadedUrls = await Promise.all(uploadPromises);
                    setPhotos(prev => [...prev, ...uploadedUrls]);
                } catch (error) { console.error(error); alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message); }
                finally { setUploadingPhotos(false); e.target.value = ''; }
            };

            const removePhoto = (index) => { setPhotos(photos.filter((_, i) => i !== index)); };

            const calculateDistance = (lat1, lng1, lat2, lng2) => {
                const R = 6371000;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLng = (lng2 - lng1) * Math.PI / 180;
                const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLng / 2) * Math.sin(dLng / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            };

            const calculateTotalDistance = (positions) => {
                if (positions.length < 2) return 0;
                let total = 0;
                for (let i = 1; i < positions.length; i++) {
                    total += calculateDistance(positions[i - 1].lat, positions[i - 1].lng, positions[i].lat, positions[i].lng);
                }
                return total;
            };

            const startWalk = () => {
                if (selectedWalkers.length === 0) { alert('æ•£æ­©è€…ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
                if (!navigator.geolocation) { alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“'); return; }
                const walk = {
                    walkers: selectedWalkers, startTime: new Date(), positions: [],
                    pee: false, poo: false, water: false, memo: '', photos: [], weather: null
                };
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        walk.positions.push({
                            lat: position.coords.latitude, lng: position.coords.longitude,
                            time: new Date(), accuracy: position.coords.accuracy
                        });
                        lastPositionRef.current = { lat: position.coords.latitude, lng: position.coords.longitude, time: Date.now() };
                        stationaryTimeRef.current = 0;
                        setCurrentWalk(walk);
                        setIsWalking(true);
                        setShowWalkSetup(false);
                        setPhotos([]);
                        setNow(new Date());

                        const notifyWalkStart = functions.httpsCallable('notifyWalkStart');
                        notifyWalkStart({ walkers: selectedWalkers })
                            .then(() => console.log('LINEé€šçŸ¥é€ä¿¡æˆåŠŸ'))
                            .catch(err => console.error('LINEé€šçŸ¥é€ä¿¡å¤±æ•—', err));

                        const weatherData = await fetchWeatherData(position.coords.latitude, position.coords.longitude);
                        if (weatherData) {
                            setCurrentWalk(prev => { if (!prev) return null; return { ...prev, weather: weatherData }; });
                        }
                    },
                    (error) => { alert('ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ä½ç½®æƒ…å ±ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚'); },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            };

            useEffect(() => {
                if (!isWalking || !currentWalk) return;
                const interval = setInterval(() => {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            if (position.coords.accuracy <= 50) {
                                const newPos = { lat: position.coords.latitude, lng: position.coords.longitude, time: new Date(), accuracy: position.coords.accuracy };
                                if (lastPositionRef.current) {
                                    const distance = calculateDistance(lastPositionRef.current.lat, lastPositionRef.current.lng, newPos.lat, newPos.lng);
                                    if (distance <= 10) {
                                        stationaryTimeRef.current += 5;
                                        if (stationaryTimeRef.current >= 300) {
                                            endWalk(); alert('5åˆ†é–“ç§»å‹•ãŒãªã‹ã£ãŸãŸã‚ã€æ•£æ­©ã‚’çµ‚äº†ã—ã¾ã—ãŸã€‚'); stationaryTimeRef.current = 0;
                                        }
                                    } else { stationaryTimeRef.current = 0; }
                                    lastPositionRef.current = { lat: newPos.lat, lng: newPos.lng, time: Date.now() };
                                }
                                setCurrentWalk(prev => ({ ...prev, positions: [...prev.positions, newPos] }));
                            }
                        },
                        (error) => { console.log('GPSå–å¾—ã‚¨ãƒ©ãƒ¼:', error); },
                        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                    );
                }, 5000);
                return () => clearInterval(interval);
            }, [isWalking, currentWalk, photos]);

            const endWalk = async () => {
                if (!currentWalk) return;
                const endTime = new Date();
                const duration = Math.floor((endTime - currentWalk.startTime) / 60000);
                const distance = calculateTotalDistance(currentWalk.positions);
                await db.collection('walks').add({
                    walkers: currentWalk.walkers,
                    startTime: firebase.firestore.Timestamp.fromDate(currentWalk.startTime),
                    endTime: firebase.firestore.Timestamp.fromDate(endTime),
                    duration, distance, pee: currentWalk.pee, poo: currentWalk.poo, water: currentWalk.water,
                    memo: currentWalk.memo, photos: photos, positions: currentWalk.positions, weather: currentWalk.weather || null
                });
                setCurrentWalk(null); setIsWalking(false); setSelectedWalkers([]); setPhotos([]); stationaryTimeRef.current = 0; lastPositionRef.current = null;
            };

            const updateWalk = async (walkId, data) => { await db.collection('walks').doc(walkId).update(data); setEditingWalk(null); };
            const deleteWalk = async (walkId) => { if (confirm('ã“ã®æ•£æ­©è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) { await db.collection('walks').doc(walkId).delete(); } };

            const saveHealthRecord = async (data) => {
                const dateTime = data.time ? new Date(`${data.date}T${data.time}`) : new Date(data.date);
                const recordData = { ...data, date: firebase.firestore.Timestamp.fromDate(dateTime) };
                delete recordData.id;
                if (data.id) { await db.collection('health').doc(data.id).update(recordData); }
                else { await db.collection('health').add(recordData); }
                setShowHealthForm(false); setEditingHealth(null);
            };

            const deleteHealthRecord = async (id) => {
                if (!id) { alert('IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); return; }
                if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) { try { await db.collection('health').doc(id).delete(); } catch (e) { alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e); } }
            };

            const formatTimer = (start) => {
                if (!start) return '0åˆ†00ç§’';
                const diffMs = now - start;
                const mins = Math.floor(diffMs / 60000);
                const secs = Math.floor((diffMs % 60000) / 1000);
                return `${mins}åˆ†${secs.toString().padStart(2, '0')}ç§’`;
            };

            const getStats = (period) => {
                const now = new Date();
                const startDate = new Date();
                if (period === 'week') {
                    const monday = getMonday(now);
                    startDate.setTime(monday.getTime());
                    startDate.setHours(0, 0, 0, 0);
                } else if (period === 'month') {
                    startDate.setDate(1); startDate.setHours(0, 0, 0, 0);
                } else if (period === 'year') {
                    startDate.setMonth(0, 1); startDate.setHours(0, 0, 0, 0);
                } else { startDate.setFullYear(2000, 0, 1); }
                const filteredWalks = period === 'all' ? walks : walks.filter(w => w.startTime >= startDate);
                const totalDistance = filteredWalks.reduce((sum, w) => sum + (w.distance || 0), 0);
                const totalDuration = filteredWalks.reduce((sum, w) => sum + (w.duration || 0), 0);
                const filteredHealth = period === 'all' ? healthRecords : healthRecords.filter(r => r.date >= startDate);
                const mealCount = filteredHealth.filter(r => r.type === 'food').length;
                const pooCount = filteredHealth.filter(r => r.type === 'excretion').length;
                const walkerStats = {};
                filteredWalks.forEach(w => {
                    const walkerList = Array.isArray(w.walkers) ? w.walkers : [w.walkers];
                    walkerList.forEach(walker => {
                        if (!walkerStats[walker]) { walkerStats[walker] = { count: 0, distance: 0, duration: 0 }; }
                        walkerStats[walker].count += 1; walkerStats[walker].distance += w.distance || 0; walkerStats[walker].duration += w.duration || 0;
                    });
                });
                return { count: filteredWalks.length, totalDistance, totalDuration, mealCount, pooCount, avgDuration: filteredWalks.length > 0 ? totalDuration / filteredWalks.length : 0, walkerStats };
            };

            const getEarnedBadges = () => {
                const totalCount = walks.length;
                const totalDistance = walks.reduce((sum, w) => sum + (w.distance || 0), 0);
                return badges.filter(badge => badge.condition(totalCount, totalDistance));
            };

            const getFirmnessEmoji = (firmness) => {
                const emojis = { 1: 'ğŸ’§ğŸ’§', 2: 'ğŸ’§', 3: 'âœ…', 4: 'âš ï¸', 5: 'ğŸ”´' };
                return emojis[firmness] || 'âœ…';
            };

            if (loading) { return React.createElement('div', { className: 'flex items-center justify-center min-h-screen' }, React.createElement('div', { className: 'text-lg' }, 'èª­ã¿è¾¼ã¿ä¸­...')); }

            const stats = getStats(statsView);
            const earnedBadges = getEarnedBadges();
            const recentWalks = walks.slice(0, 20);
            const recentHealth = healthRecords.slice(0, 20);

            const allRecords = [...walks.map(w => ({ ...w, type: 'walk' })), ...healthRecords]
                .sort((a, b) => {
                    const dateA = a.type === 'walk' ? a.startTime : a.date;
                    const dateB = b.type === 'walk' ? b.startTime : b.date;
                    return dateB - dateA;
                });

            return React.createElement('div', { className: 'max-w-md mx-auto bg-white min-h-screen pb-20' },
                React.createElement('div', { className: 'bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4' }, React.createElement('h1', { className: 'text-2xl font-bold' }, 'ğŸ• ç¦ã¨ã„ã£ã—ã‚‡')),
                React.createElement('div', { className: 'flex border-b overflow-x-auto' },
                    React.createElement('button', { onClick: () => handleTabChange('home'), className: `flex-shrink-0 px-4 py-3 ${activeTab === 'home' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}` }, 'ãƒ›ãƒ¼ãƒ '),
                    React.createElement('button', { onClick: () => handleTabChange('health'), className: `flex-shrink-0 px-4 py-3 ${activeTab === 'health' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}` }, 'ãŠä¸–è©±'),
                    React.createElement('button', { onClick: () => handleTabChange('stats'), className: `flex-shrink-0 px-4 py-3 ${activeTab === 'stats' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}` }, 'çµ±è¨ˆ'),
                    React.createElement('button', { onClick: () => handleTabChange('badges'), className: `flex-shrink-0 px-4 py-3 ${activeTab === 'badges' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}` }, 'ãƒãƒƒã‚¸'),
                    React.createElement('button', { onClick: () => handleTabChange('settings'), className: `flex-shrink-0 px-4 py-3 ${activeTab === 'settings' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}` }, 'è¨­å®š')
                ),

                activeTab === 'home' && React.createElement('div', { className: 'p-4' },
                    React.createElement('div', { className: 'bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-lg mb-4 shadow-sm' },
                        React.createElement('h2', { className: 'text-xl font-bold mb-3' }, 'ğŸ“Š ' + getPeriodLabel('week')),
                        React.createElement('div', { className: 'grid grid-cols-5 gap-1' },
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'æ•£æ­©'), React.createElement('p', { className: 'text-lg font-bold text-blue-600' }, getStats('week').count, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'å›'))),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'è·é›¢'), React.createElement('p', { className: 'text-lg font-bold text-green-600' }, (getStats('week').totalDistance / 1000).toFixed(1), React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'km'))),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'æ™‚é–“'), React.createElement('p', { className: 'text-lg font-bold text-purple-600' }, getStats('week').totalDuration, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'åˆ†'))),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'ã”é£¯'), React.createElement('p', { className: 'text-lg font-bold text-orange-600' }, getStats('week').mealCount, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'å›'))),
                            React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'æ’æ³„'), React.createElement('p', { className: 'text-lg font-bold text-yellow-600' }, getStats('week').pooCount, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'å›')))
                        )
                    ),
                    React.createElement('h3', { className: 'font-bold mb-2 text-lg flex items-center' }, React.createElement('span', { className: 'mr-2' }, 'ğŸ•’'), 'æœ€è¿‘ã®è¨˜éŒ²'),
                    React.createElement('div', { className: 'space-y-3 max-h-96 overflow-y-auto pr-1' },
                        allRecords.length === 0 ? React.createElement('p', { className: 'text-center text-gray-500 mt-4' }, 'ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“') :
                            allRecords.slice(0, 10).map(item => item.type === 'walk' ?
                                React.createElement('div', { key: 'w-' + item.id, className: 'border rounded-lg p-3 bg-white shadow-sm' },
                                    React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                                        React.createElement('div', { className: 'flex-1' },
                                            React.createElement('p', { className: 'font-bold text-lg' }, 'ğŸš¶ æ•£æ­© (' + (Array.isArray(item.walkers) ? item.walkers.join(', ') : item.walkers) + ')'),
                                            React.createElement('div', { className: 'flex gap-1 mt-1' },
                                                item.pee && React.createElement('span', { className: 'text-lg' }, 'ğŸ’§'), item.poo && React.createElement('span', { className: 'text-lg' }, 'ğŸ’©'), item.water && React.createElement('span', { className: 'text-lg' }, 'ğŸ¥¤')
                                            )
                                        ),
                                        React.createElement('div', { className: 'text-right flex flex-col items-end pl-2' },
                                            // â˜…ç›¸å¯¾æ™‚é–“è¡¨ç¤ºã‚’ä½¿ç”¨
                                            React.createElement('div', { className: 'text-xs text-gray-500 font-bold' }, formatRelativeTime(item.startTime)),
                                            React.createElement('div', { className: 'text-xs text-gray-500 font-bold' }, 'â±ï¸' + item.duration + 'åˆ† ğŸ“' + (item.distance / 1000).toFixed(2) + 'km'),
                                            item.weather && React.createElement('div', { className: 'text-xs text-gray-600 font-medium mt-1' }, `${getWeatherEmoji(item.weather.icon)} ${item.weather.temp}â„ƒ ğŸ’¨${item.weather.wind}m`)
                                        )
                                    ),
                                    React.createElement('div', null,
                                        item.memo && React.createElement('div', { className: 'text-sm text-gray-600 mb-1 bg-gray-50 p-1 rounded' }, item.memo),
                                        item.photos && item.photos.length > 0 && React.createElement('div', { className: 'flex gap-1 mt-2 mb-2 overflow-x-auto' },
                                            item.photos.map((url, i) => React.createElement('img', { key: i, src: url, className: 'h-16 w-16 object-cover rounded cursor-pointer border border-gray-200', onClick: () => setViewingPhoto(url) }))
                                        ),
                                        React.createElement('div', { className: 'flex justify-end gap-2' },
                                            item.positions && item.positions.length > 0 && React.createElement('button', { onClick: () => setShowMap(item.positions), className: 'px-3 py-1 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded text-xs font-bold' }, 'åœ°å›³'),
                                            React.createElement('button', { onClick: () => setEditingWalk(item), className: 'px-3 py-1 text-gray-600 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold' }, 'ç·¨é›†'),
                                            React.createElement('button', { onClick: () => deleteWalk(item.id), className: 'px-3 py-1 text-red-600 bg-red-50 hover:bg-red-100 rounded text-xs font-bold' }, 'å‰Šé™¤')
                                        )
                                    )
                                ) :
                                React.createElement('div', { key: 'h-' + item.id, className: 'border rounded-lg p-3 bg-white shadow-sm' },
                                    React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                                        React.createElement('div', null, React.createElement('p', { className: 'font-bold text-lg' }, (item.type === 'hospital' ? 'ğŸ¥ ç—…é™¢' : item.type === 'grooming' ? 'âœ‚ï¸ æ•£é«ª' : item.type === 'bath' ? 'ğŸ› å…¥æµ´' : item.type === 'food' ? 'ğŸ¥£ ã”é£¯' : item.type === 'excretion' ? 'ğŸ’© æ’æ³„' : 'ğŸ’Š è–¬') + ' (' + item.walker + ')')),
                                        // â˜…ç›¸å¯¾æ™‚é–“è¡¨ç¤ºã‚’ä½¿ç”¨
                                        React.createElement('div', { className: 'text-right' }, React.createElement('p', { className: 'text-xs text-gray-500 font-bold whitespace-nowrap' }, formatRelativeTime(item.date)))
                                    ),
                                    React.createElement('div', { className: 'mb-2' },
                                        item.photos && item.photos.length > 0 && React.createElement('div', { className: 'flex gap-1 mb-2 overflow-x-auto' },
                                            item.photos.map((url, i) => React.createElement('img', { key: i, src: url, className: 'h-16 w-16 object-cover rounded cursor-pointer border border-gray-200', onClick: () => setViewingPhoto(url) }))
                                        ),
                                        item.hospitalName && React.createElement('p', { className: 'text-sm' }, 'ğŸ¥ ' + item.hospitalName),
                                        item.medicineType && React.createElement('p', { className: 'text-sm text-blue-600' }, 'ğŸ’Š ' + item.medicineType),
                                        item.type === 'excretion' && item.pooFirmness && React.createElement('p', { className: 'text-sm' }, 'ç¡¬ã•: ' + getFirmnessEmoji(item.pooFirmness)),
                                        item.type === 'food' && item.foodAmount && React.createElement('p', { className: 'text-sm' }, 'æ®‹é‡: ' + (['', 'ç©ºã£ã½', 'å°‘ã—', 'æ™®é€š', 'å¤šã‚', 'æº€æ¯'][item.foodAmount] || 'æ™®é€š') + ` (${item.foodAmount}/5)`),
                                        item.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-1' }, item.memo)
                                    )
                                )
                            )
                    )
                ),

                activeTab === 'health' && React.createElement('div', { className: 'p-4' },
                    isWalking ? React.createElement('div', { className: 'space-y-4' },
                        React.createElement('div', { className: 'bg-blue-50 p-4 rounded-lg border-2 border-blue-200' },
                            React.createElement('p', { className: 'text-sm text-gray-600 mb-1' }, 'ğŸ‘¥ æ•£æ­©è€…: ' + currentWalk?.walkers.join(', ')),
                            React.createElement('p', { className: 'text-lg font-bold text-blue-700 mb-1' }, 'â±ï¸ çµŒéæ™‚é–“: ' + formatTimer(currentWalk?.startTime)),
                            React.createElement('p', { className: 'text-sm text-gray-600 mb-1' }, 'ğŸ“ è·é›¢: ' + (calculateTotalDistance(currentWalk?.positions || []) / 1000).toFixed(2) + 'km'),
                            currentWalk?.positions && currentWalk.positions.length > 0 && React.createElement('p', { className: 'text-xs text-gray-500' }, 'ğŸ¯ GPSç²¾åº¦: ' + (currentWalk.positions[currentWalk.positions.length - 1]?.accuracy?.toFixed(0) || 'æ¸¬å®šä¸­') + 'm')
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'è¨˜éŒ²'),
                            React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                                React.createElement('button', { onClick: () => setCurrentWalk({ ...currentWalk, pee: !currentWalk.pee }), className: `py-3 rounded-lg border-2 font-bold ${currentWalk?.pee ? 'bg-yellow-100 border-yellow-500' : 'border-gray-300'}` }, 'ğŸ’§ ãŠã—ã£ã“'),
                                React.createElement('button', { onClick: () => setCurrentWalk({ ...currentWalk, poo: !currentWalk.poo }), className: `py-3 rounded-lg border-2 font-bold ${currentWalk?.poo ? 'bg-amber-100 border-amber-500' : 'border-gray-300'}` }, 'ğŸ’© ã†ã‚“ã¡'),
                                React.createElement('button', { onClick: () => setCurrentWalk({ ...currentWalk, water: !currentWalk.water }), className: `py-3 rounded-lg border-2 font-bold ${currentWalk?.water ? 'bg-blue-100 border-blue-500' : 'border-gray-300'}` }, 'ğŸ’§ æ°´')
                            )
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'å†™çœŸ (æœ€å¤§4æš)'),
                            React.createElement('div', { className: 'grid grid-cols-4 gap-2 mb-2' },
                                photos.map((url, i) => React.createElement('div', { key: i, className: 'relative' },
                                    React.createElement('img', { src: url, className: 'w-full h-20 object-cover rounded' }),
                                    React.createElement('button', { onClick: () => removePhoto(i), className: 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 text-xs' }, 'Ã—')
                                ))
                            ),
                            photos.length < 4 && React.createElement('input', { type: 'file', accept: 'image/*', multiple: true, onChange: handlePhotoUpload, disabled: uploadingPhotos, className: 'w-full text-sm' }),
                            uploadingPhotos && React.createElement('p', { className: 'text-sm text-gray-500' }, 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...')
                        ),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ãƒ¡ãƒ¢'),
                            React.createElement('textarea', { value: currentWalk?.memo || '', onChange: (e) => setCurrentWalk({ ...currentWalk, memo: e.target.value }), className: 'w-full p-2 border rounded-lg', rows: 3, placeholder: 'æ°—ã¥ã„ãŸã“ã¨ã‚’ãƒ¡ãƒ¢...' })
                        ),
                        React.createElement('button', { onClick: () => { if (confirm('æ•£æ­©ã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ')) endWalk(); }, disabled: uploadingPhotos, className: `w-full py-4 rounded-lg text-xl font-bold shadow-md ${uploadingPhotos ? 'bg-gray-400 cursor-not-allowed' : 'bg-red-500 text-white hover:bg-red-600'}` }, uploadingPhotos ? 'å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...' : 'ğŸ æ•£æ­©çµ‚äº†')
                    ) : showWalkSetup ? React.createElement('div', { className: 'space-y-4' },
                        React.createElement('h3', { className: 'font-bold text-lg' }, 'ğŸš¶ æ•£æ­©ã®æº–å‚™'),
                        React.createElement('div', null,
                            React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æ•£æ­©è€…ã‚’é¸æŠ'),
                            React.createElement('div', { className: 'space-y-2' },
                                walkers.map(w => React.createElement('label', { key: w.id, className: 'flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50' },
                                    React.createElement('input', { type: 'checkbox', checked: selectedWalkers.includes(w.name), onChange: () => toggleWalker(w.name), className: 'mr-2 w-5 h-5' }), React.createElement('span', null, w.name)
                                ))
                            ),
                            selectedWalkers.length > 0 && React.createElement('p', { className: 'text-sm text-gray-600 mt-2' }, 'é¸æŠä¸­: ' + selectedWalkers.join(', '))
                        ),
                        React.createElement('div', { className: 'flex gap-2' },
                            React.createElement('button', { onClick: startWalk, className: 'flex-1 bg-green-500 text-white py-3 rounded-lg text-lg font-bold shadow' }, 'é–‹å§‹'),
                            React.createElement('button', { onClick: () => setShowWalkSetup(false), className: 'flex-1 bg-gray-300 text-black py-3 rounded-lg text-lg font-bold' }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
                        )
                    ) : !showHealthForm ? React.createElement('div', null,
                        React.createElement('div', { className: 'grid grid-cols-3 gap-2 mb-6' },
                            React.createElement('button', { onClick: () => setShowWalkSetup(true), className: 'bg-green-500 text-white p-4 rounded-lg text-center flex flex-col items-center shadow-md transform active:scale-95 transition-transform' }, React.createElement('span', { className: 'text-2xl mb-1' }, 'ğŸš¶'), React.createElement('span', { className: 'text-xs font-bold' }, 'æ•£æ­©')),
                            React.createElement('button', { onClick: () => initHealthForm('excretion', null), className: 'bg-yellow-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm' }, React.createElement('span', { className: 'text-2xl mb-1' }, 'ğŸ’©'), React.createElement('span', { className: 'text-xs font-bold' }, 'æ’æ³„')),
                            React.createElement('button', { onClick: () => initHealthForm('food', null), className: 'bg-orange-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm' }, React.createElement('span', { className: 'text-2xl mb-1' }, 'ğŸ¥£'), React.createElement('span', { className: 'text-xs font-bold' }, 'ã”é£¯')),
                            React.createElement('button', { onClick: () => initHealthForm('medicine', null), className: 'bg-green-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm' }, React.createElement('span', { className: 'text-2xl mb-1' }, 'ğŸ’Š'), React.createElement('span', { className: 'text-xs font-bold' }, 'è–¬')),
                            React.createElement('button', { onClick: () => initHealthForm('bath', null), className: 'bg-blue-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm' }, React.createElement('span', { className: 'text-2xl mb-1' }, 'ğŸ›'), React.createElement('span', { className: 'text-xs font-bold' }, 'å…¥æµ´')),
                            React.createElement('button', { onClick: () => initHealthForm('grooming', null), className: 'bg-pink-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm' }, React.createElement('span', { className: 'text-2xl mb-1' }, 'âœ‚ï¸'), React.createElement('span', { className: 'text-xs font-bold' }, 'æ•£é«ª')),
                            React.createElement('button', { onClick: () => initHealthForm('hospital', null), className: 'bg-red-100 p-4 rounded-lg text-center flex flex-col items-center shadow-sm' }, React.createElement('span', { className: 'text-2xl mb-1' }, 'ğŸ¥'), React.createElement('span', { className: 'text-xs font-bold' }, 'ç—…é™¢'))
                        ),
                        React.createElement('h3', { className: 'font-bold mb-3' }, 'ãŠä¸–è©±ã—ãŸã‚ˆ'),
                        React.createElement('div', { className: 'space-y-3' },
                            allRecords.length === 0 ? React.createElement('p', { className: 'text-center text-gray-500 mt-4' }, 'è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“') :
                                allRecords.map(item => item.type === 'walk' ?
                                    React.createElement('div', { key: 'w-' + item.id, className: 'border rounded-lg p-3 bg-white shadow-sm' },
                                        React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                                            React.createElement('div', { className: 'flex-1' },
                                                React.createElement('p', { className: 'font-bold text-lg' }, 'ğŸš¶ æ•£æ­© (' + (Array.isArray(item.walkers) ? item.walkers.join(', ') : item.walkers) + ')'),
                                                React.createElement('div', { className: 'flex gap-1 mt-1' },
                                                    item.pee && React.createElement('span', { className: 'text-lg' }, 'ğŸ’§'), item.poo && React.createElement('span', { className: 'text-lg' }, 'ğŸ’©'), item.water && React.createElement('span', { className: 'text-lg' }, 'ğŸ¥¤')
                                                )
                                            ),
                                            React.createElement('div', { className: 'text-right flex flex-col items-end pl-2' },
                                                // â˜…ç›¸å¯¾æ™‚é–“è¡¨ç¤ºã‚’ä½¿ç”¨
                                                React.createElement('div', { className: 'text-xs text-gray-500 font-bold' }, formatRelativeTime(item.startTime)),
                                                React.createElement('div', { className: 'text-xs text-gray-500 font-bold' }, 'â±ï¸' + item.duration + 'åˆ† ğŸ“' + (item.distance / 1000).toFixed(2) + 'km'),
                                                item.weather && React.createElement('div', { className: 'text-xs text-gray-600 font-medium mt-1' }, `${getWeatherEmoji(item.weather.icon)} ${item.weather.temp}â„ƒ ğŸ’¨${item.weather.wind}m`)
                                            )
                                        ),
                                        React.createElement('div', null,
                                            item.memo && React.createElement('div', { className: 'text-sm text-gray-600 mb-1 bg-gray-50 p-1 rounded' }, item.memo),
                                            item.photos && item.photos.length > 0 && React.createElement('div', { className: 'flex gap-1 mt-2 mb-2 overflow-x-auto' },
                                                item.photos.map((url, i) => React.createElement('img', { key: i, src: url, className: 'h-16 w-16 object-cover rounded cursor-pointer border border-gray-200', onClick: () => setViewingPhoto(url) }))
                                            ),
                                            React.createElement('div', { className: 'flex justify-end gap-2' },
                                                item.positions && item.positions.length > 0 && React.createElement('button', { onClick: () => setShowMap(item.positions), className: 'px-3 py-1 text-blue-600 bg-blue-50 hover:bg-blue-100 rounded text-xs font-bold' }, 'åœ°å›³'),
                                                React.createElement('button', { onClick: () => setEditingWalk(item), className: 'px-3 py-1 text-gray-600 bg-gray-50 hover:bg-gray-100 rounded text-xs font-bold' }, 'ç·¨é›†'),
                                                React.createElement('button', { onClick: () => deleteWalk(item.id), className: 'px-3 py-1 text-red-600 bg-red-50 hover:bg-red-100 rounded text-xs font-bold' }, 'å‰Šé™¤')
                                            )
                                        )
                                    ) :
                                    React.createElement('div', { key: 'h-' + item.id, className: 'border rounded-lg p-3 bg-white shadow-sm' },
                                        React.createElement('div', { className: 'flex justify-between items-start' },
                                            React.createElement('div', { className: 'flex-1' },
                                                React.createElement('p', { className: 'font-bold text-lg' }, (item.type === 'hospital' ? 'ğŸ¥ ç—…é™¢' : item.type === 'grooming' ? 'âœ‚ï¸ æ•£é«ª' : item.type === 'bath' ? 'ğŸ› å…¥æµ´' : item.type === 'food' ? 'ğŸ¥£ ã”é£¯' : item.type === 'excretion' ? 'ğŸ’© æ’æ³„' : 'ğŸ’Š è–¬') + ' (' + item.walker + ')'),
                                                React.createElement('div', { className: 'mt-1' },
                                                    item.hospitalName && React.createElement('p', { className: 'text-sm' }, 'ğŸ¥ ' + item.hospitalName),
                                                    item.medicineType && React.createElement('p', { className: 'text-sm text-blue-600' }, 'ğŸ’Š ' + item.medicineType),
                                                    item.type === 'excretion' && item.pooFirmness && React.createElement('p', { className: 'text-sm' }, 'ç¡¬ã•: ' + getFirmnessEmoji(item.pooFirmness)),
                                                    item.type === 'food' && item.foodAmount && React.createElement('p', { className: 'text-sm' }, 'æ®‹é‡: ' + (['', 'ç©ºã£ã½', 'å°‘ã—', 'æ™®é€š', 'å¤šã‚', 'æº€æ¯'][item.foodAmount] || 'æ™®é€š') + ` (${item.foodAmount}/5)`),
                                                    item.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-1' }, item.memo)
                                                )
                                            ),
                                            React.createElement('div', { className: 'text-right flex flex-col justify-between items-end gap-2' },
                                                // â˜…ç›¸å¯¾æ™‚é–“è¡¨ç¤ºã‚’ä½¿ç”¨
                                                React.createElement('p', { className: 'text-xs text-gray-500 font-bold whitespace-nowrap' }, formatRelativeTime(item.date)),
                                                React.createElement('div', { className: 'flex gap-2' },
                                                    React.createElement('button', { onClick: () => initHealthForm(item.type, item), className: 'text-blue-500 text-xs font-bold border border-blue-200 px-2 py-1 rounded' }, 'ç·¨é›†'),
                                                    React.createElement('button', { onClick: () => deleteHealthRecord(item.id), className: 'text-red-500 text-xs px-2 py-1' }, 'å‰Šé™¤')
                                                )
                                            )
                                        ),
                                        item.photos && item.photos.length > 0 && React.createElement('div', { className: 'flex gap-1 mt-2 overflow-x-auto' },
                                            item.photos.map((url, i) => React.createElement('img', { key: i, src: url, className: 'h-16 w-16 object-cover rounded cursor-pointer border border-gray-200', onClick: () => setViewingPhoto(url) }))
                                        )
                                    )
                                )
                        )
                    ) : React.createElement(HealthForm, {
                        type: healthType, walkers: walkers, formData: healthFormData, onChange: setHealthFormData,
                        onSave: saveHealthRecord, onCancel: () => { setShowHealthForm(false); setEditingHealth(null); }
                    })
                ),

                activeTab === 'stats' && React.createElement('div', { className: 'p-4' },
                    React.createElement('div', { className: 'flex gap-2 mb-4 overflow-x-auto' },
                        ['week', 'month', 'year', 'all'].map(v => React.createElement('button', {
                            key: v, onClick: () => setStatsView(v), className: `flex-shrink-0 px-4 py-2 rounded text-sm font-bold ${statsView === v ? 'bg-blue-500 text-white shadow' : 'bg-gray-200'}`
                        }, v === 'week' ? 'ä»Šé€±' : v === 'month' ? 'ä»Šæœˆ' : v === 'year' ? 'ä»Šå¹´' : 'å…¨æœŸé–“'))
                    ),
                    React.createElement('div', { className: 'space-y-4' },
                        React.createElement('div', { className: 'bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-lg shadow-sm border border-blue-200' },
                            React.createElement('h3', { className: 'font-bold mb-2' }, 'ğŸ“Š ' + getPeriodLabel(statsView)),
                            React.createElement('div', { className: 'grid grid-cols-5 gap-1' },
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'æ•£æ­©'), React.createElement('p', { className: 'text-lg font-bold text-blue-600' }, getStats(statsView).count, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'å›'))),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'è·é›¢'), React.createElement('p', { className: 'text-lg font-bold text-green-600' }, (getStats(statsView).totalDistance / 1000).toFixed(1), React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'km'))),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'æ™‚é–“'), React.createElement('p', { className: 'text-lg font-bold text-purple-600' }, getStats(statsView).totalDuration, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'åˆ†'))),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'ã”é£¯'), React.createElement('p', { className: 'text-lg font-bold text-orange-600' }, getStats(statsView).mealCount, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'å›'))),
                                React.createElement('div', { className: 'bg-white p-2 rounded text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-600' }, 'æ’æ³„'), React.createElement('p', { className: 'text-lg font-bold text-yellow-600' }, getStats(statsView).pooCount, React.createElement('span', { className: 'text-xs text-gray-400 ml-0.5' }, 'å›')))
                            )
                        )
                    )
                ),

                activeTab === 'badges' && React.createElement('div', { className: 'p-4' },
                    React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'ğŸ† å®Ÿç¸¾ãƒ»ãƒãƒƒã‚¸'),
                    React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                        badges.map(badge => {
                            const earned = earnedBadges.find(b => b.id === badge.id);
                            return React.createElement('div', { key: badge.id, className: `p-4 rounded-lg text-center ${earned ? 'bg-gradient-to-br from-yellow-50 to-orange-100 border-2 border-yellow-400 shadow-sm' : 'bg-gray-100 opacity-50'}` },
                                React.createElement('div', { className: 'text-4xl mb-2' }, badge.icon),
                                React.createElement('p', { className: 'font-bold text-sm' }, badge.name),
                                earned && React.createElement('p', { className: 'text-xs text-green-600 mt-1 font-bold' }, 'âœ“ ç²å¾—æ¸ˆã¿')
                            );
                        })
                    )
                ),

                activeTab === 'settings' && React.createElement('div', { className: 'p-4' },
                    React.createElement('h2', { className: 'text-xl font-bold mb-4 flex items-center' }, React.createElement('span', { className: 'mr-2' }, 'ğŸ '), 'è’æœ¨å®¶'),
                    React.createElement('div', { className: 'space-y-2 mb-4' },
                        walkers.map(w => React.createElement('div', { key: w.id, className: 'flex items-center justify-between p-3 border rounded-lg bg-white shadow-sm' },
                            React.createElement('span', { className: 'font-medium' }, w.name),
                            React.createElement('button', { onClick: () => deleteWalker(w.id), className: 'text-red-500 text-sm font-bold' }, 'å‰Šé™¤')
                        ))
                    ),
                    !showAddWalker ? React.createElement('button', { onClick: () => setShowAddWalker(true), className: 'w-full bg-blue-500 text-white py-3 rounded-lg font-bold shadow-md' }, '+ ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ') : React.createElement('div', { className: 'space-y-2 bg-gray-50 p-4 rounded-lg' },
                        React.createElement('input', { type: 'text', value: newWalkerName, onChange: (e) => setNewWalkerName(e.target.value), placeholder: 'åå‰ã‚’å…¥åŠ›', className: 'w-full p-2 border rounded' }),
                        React.createElement('div', { className: 'flex gap-2' },
                            React.createElement('button', { onClick: addWalker, className: 'flex-1 bg-green-500 text-white py-2 rounded font-bold' }, 'è¿½åŠ '),
                            React.createElement('button', { onClick: () => { setShowAddWalker(false); setNewWalkerName(''); }, className: 'flex-1 bg-gray-300 py-2 rounded' }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
                        )
                    )
                ),

                React.createElement('div', { className: 'fixed bottom-0 left-0 right-0 bg-gray-100 border-t p-2 text-center' },
                    React.createElement('p', { className: 'text-xs text-gray-500 font-medium' }, 'ç¦ã¨ã„ã£ã—ã‚‡ ' + APP_VERSION)
                ),

                editingWalk && React.createElement(WalkEditForm, { walk: editingWalk, walkers: walkers, onSave: (data) => updateWalk(editingWalk.id, data), onCancel: () => setEditingWalk(null) }),
                showMap && React.createElement(MapView, { positions: showMap, onClose: () => setShowMap(null) }),
                viewingPhoto && React.createElement(PhotoViewer, { src: viewingPhoto, onClose: () => setViewingPhoto(null) })
            );
        }

        ReactDOM.render(React.createElement(App), document.getElementById('app'));
    </script>
</body>

</html>