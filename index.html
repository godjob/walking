<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¦ã¨ã„ã£ã—ã‚‡</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body class="bg-gray-100">
  <div id="app"></div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAqGO0-RnJAfQqsIunx35ZuAGc85cFD-lA",
      authDomain: "walking-36c5a.firebaseapp.com",
      projectId: "walking-36c5a",
      storageBucket: "walking-36c5a.firebasestorage.app",
      messagingSenderId: "457304106244",
      appId: "1:457304106244:web:3bcb8df4d4a3b27a971c51"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();
    const { useState, useEffect, useRef } = React;

    const badges = [
      { id: 'first', name: 'åˆã‚ã¦ã®æ•£æ­©', icon: 'ğŸ‰', condition: (c) => c >= 1 },
      { id: 'ten', name: 'æ•£æ­©10å›', icon: 'ğŸŒŸ', condition: (c) => c >= 10 },
      { id: 'fifty', name: 'æ•£æ­©50å›', icon: 'â­', condition: (c) => c >= 50 },
      { id: 'hundred', name: 'æ•£æ­©100å›', icon: 'ğŸ‘‘', condition: (c) => c >= 100 },
      { id: 'distance10', name: 'åˆè¨ˆ10km', icon: 'ğŸƒ', condition: (c, d) => d >= 10000 },
      { id: 'distance50', name: 'åˆè¨ˆ50km', icon: 'ğŸš€', condition: (c, d) => d >= 50000 },
      { id: 'distance100', name: 'åˆè¨ˆ100km', icon: 'ğŸ–ï¸', condition: (c, d) => d >= 100000 }
    ];

    function MapView({ positions, onClose }) {
      const mapRef = useRef(null);
      const mapInstanceRef = useRef(null);

      useEffect(() => {
        if (!positions || positions.length === 0 || !mapRef.current) return;

        if (!mapInstanceRef.current) {
          mapInstanceRef.current = L.map(mapRef.current).setView(
            [positions[0].lat, positions[0].lng],
            15
          );
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
          }).addTo(mapInstanceRef.current);
        }

        const latLngs = positions.map(p => [p.lat, p.lng]);
        L.polyline(latLngs, { color: 'blue', weight: 4 }).addTo(mapInstanceRef.current);
        
        if (latLngs.length > 0) {
          mapInstanceRef.current.fitBounds(latLngs);
        }

        return () => {
          if (mapInstanceRef.current) {
            mapInstanceRef.current.remove();
            mapInstanceRef.current = null;
          }
        };
      }, [positions]);

      return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4' },
        React.createElement('div', { className: 'bg-white rounded-lg w-full max-w-2xl' },
          React.createElement('div', { className: 'p-4 border-b flex justify-between items-center' },
            React.createElement('h3', { className: 'font-bold text-lg' }, 'ğŸ—ºï¸ æ•£æ­©ã‚³ãƒ¼ã‚¹'),
            React.createElement('button', {
              onClick: onClose,
              className: 'text-gray-500 hover:text-gray-700 text-2xl'
            }, 'Ã—')
          ),
          React.createElement('div', {
            ref: mapRef,
            className: 'w-full h-96'
          })
        )
      );
    }

    function WalkEditForm({ walk, walkers, onSave, onCancel }) {
      const [formData, setFormData] = useState({
        walkers: walk.walkers || [],
        pee: walk.pee || false,
        poo: walk.poo || false,
        water: walk.water || false,
        memo: walk.memo || ''
      });

      const toggleWalker = (walkerName) => {
        setFormData(prev => ({
          ...prev,
          walkers: prev.walkers.includes(walkerName)
            ? prev.walkers.filter(w => w !== walkerName)
            : [...prev.walkers, walkerName]
        }));
      };

      const handleSubmit = () => {
        if (formData.walkers.length === 0) {
          alert('æ•£æ­©è€…ã‚’é¸æŠã—ã¦ãã ã•ã„');
          return;
        }
        onSave(formData);
      };

      return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4' },
        React.createElement('div', { className: 'bg-white rounded-lg w-full max-w-md max-h-screen overflow-y-auto' },
          React.createElement('div', { className: 'p-4' },
            React.createElement('h3', { className: 'font-bold text-lg mb-4' }, 'æ•£æ­©è¨˜éŒ²ã‚’ç·¨é›†'),
            React.createElement('div', { className: 'space-y-4' },
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æ•£æ­©è€…'),
                React.createElement('div', { className: 'space-y-2' },
                  walkers.map(w => React.createElement('label', {
                    key: w.id,
                    className: 'flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50'
                  },
                    React.createElement('input', {
                      type: 'checkbox',
                      checked: formData.walkers.includes(w.name),
                      onChange: () => toggleWalker(w.name),
                      className: 'mr-2 w-5 h-5'
                    }),
                    React.createElement('span', null, w.name)
                  ))
                )
              ),
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'è¨˜éŒ²'),
                React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                  React.createElement('button', {
                    onClick: () => setFormData({...formData, pee: !formData.pee}),
                    type: 'button',
                    className: `py-3 rounded-lg border-2 ${formData.pee ? 'bg-yellow-100 border-yellow-500' : 'border-gray-300'}`
                  }, 'ğŸ’§ ãŠã—ã£ã“'),
                  React.createElement('button', {
                    onClick: () => setFormData({...formData, poo: !formData.poo}),
                    type: 'button',
                    className: `py-3 rounded-lg border-2 ${formData.poo ? 'bg-amber-100 border-amber-500' : 'border-gray-300'}`
                  }, 'ğŸ’© ã†ã‚“ã¡'),
                  React.createElement('button', {
                    onClick: () => setFormData({...formData, water: !formData.water}),
                    type: 'button',
                    className: `py-3 rounded-lg border-2 ${formData.water ? 'bg-blue-100 border-blue-500' : 'border-gray-300'}`
                  }, 'ğŸ’§ æ°´')
                )
              ),
              React.createElement('div', null,
                React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ãƒ¡ãƒ¢'),
                React.createElement('textarea', {
                  value: formData.memo,
                  onChange: (e) => setFormData({...formData, memo: e.target.value}),
                  className: 'w-full p-2 border rounded-lg',
                  rows: 3
                })
              ),
              React.createElement('div', { className: 'flex gap-2' },
                React.createElement('button', {
                  onClick: handleSubmit,
                  className: 'flex-1 bg-blue-500 text-white py-2 rounded-lg'
                }, 'ä¿å­˜'),
                React.createElement('button', {
                  onClick: onCancel,
                  className: 'flex-1 bg-gray-300 py-2 rounded-lg'
                }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
              )
            )
          )
        )
      );
    }

    function HealthForm({ type, walkers, onSave, onCancel }) {
      const [formData, setFormData] = useState({
        type: type,
        date: new Date().toISOString().split('T')[0],
        hospitalName: '',
        reason: '',
        groomedBy: 'walker',
        walker: '',
        shopName: '',
        medicineType: '',
        isVaccine: false,
        memo: ''
      });

      const handleSubmit = () => {
        if (type === 'hospital' && !formData.hospitalName) {
          alert('ç—…é™¢åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        if (type === 'grooming' && formData.groomedBy === 'shop' && !formData.shopName) {
          alert('åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        if (type === 'medicine' && !formData.medicineType) {
          alert('è–¬ã®ç¨®é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        onSave(formData);
      };

      return React.createElement('div', { className: 'space-y-4' },
        React.createElement('h3', { className: 'font-bold text-lg' },
          type === 'hospital' ? 'ğŸ¥ ç—…é™¢è¨˜éŒ²' :
          type === 'grooming' ? 'âœ‚ï¸ æ•£é«ªè¨˜éŒ²' :
          type === 'bath' ? 'ğŸ› å…¥æµ´è¨˜éŒ²' : 'ğŸ’Š è–¬è¨˜éŒ²'
        ),
        React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'æ—¥ä»˜'),
          React.createElement('input', {
            type: 'date',
            value: formData.date,
            onChange: (e) => setFormData({...formData, date: e.target.value}),
            className: 'w-full p-2 border rounded'
          })
        ),
        type === 'hospital' && React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ç—…é™¢å'),
          React.createElement('input', {
            type: 'text',
            value: formData.hospitalName,
            onChange: (e) => setFormData({...formData, hospitalName: e.target.value}),
            className: 'w-full p-2 border rounded',
            placeholder: 'ä¾‹: â—‹â—‹å‹•ç‰©ç—…é™¢'
          }),
          React.createElement('label', { className: 'block text-sm font-medium mb-1 mt-2' }, 'ç†ç”±'),
          React.createElement('input', {
            type: 'text',
            value: formData.reason,
            onChange: (e) => setFormData({...formData, reason: e.target.value}),
            className: 'w-full p-2 border rounded',
            placeholder: 'ä¾‹: å®šæœŸæ¤œè¨º'
          })
        ),
        type === 'grooming' && React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'æ•£é«ªè€…'),
          React.createElement('div', { className: 'space-y-2' },
            React.createElement('label', { className: 'flex items-center' },
              React.createElement('input', {
                type: 'radio',
                name: 'groomedBy',
                value: 'walker',
                checked: formData.groomedBy === 'walker',
                onChange: (e) => setFormData({...formData, groomedBy: e.target.value}),
                className: 'mr-2'
              }),
              'æ•£æ­©è€…ãŒæ•£é«ª'
            ),
            formData.groomedBy === 'walker' && React.createElement('select', {
              value: formData.walker,
              onChange: (e) => setFormData({...formData, walker: e.target.value}),
              className: 'w-full p-2 border rounded ml-6'
            },
              React.createElement('option', { value: '' }, 'é¸æŠã—ã¦ãã ã•ã„'),
              walkers.map(w => React.createElement('option', { key: w.id, value: w.name }, w.name))
            ),
            React.createElement('label', { className: 'flex items-center' },
              React.createElement('input', {
                type: 'radio',
                name: 'groomedBy',
                value: 'shop',
                checked: formData.groomedBy === 'shop',
                onChange: (e) => setFormData({...formData, groomedBy: e.target.value}),
                className: 'mr-2'
              }),
              'åº—èˆ—ã§æ•£é«ª'
            ),
            formData.groomedBy === 'shop' && React.createElement('input', {
              type: 'text',
              value: formData.shopName,
              onChange: (e) => setFormData({...formData, shopName: e.target.value}),
              className: 'w-full p-2 border rounded ml-6',
              placeholder: 'åº—èˆ—åã‚’å…¥åŠ›'
            })
          )
        ),
        type === 'medicine' && React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'è–¬ã®ç¨®é¡'),
          React.createElement('input', {
            type: 'text',
            value: formData.medicineType,
            onChange: (e) => setFormData({...formData, medicineType: e.target.value}),
            className: 'w-full p-2 border rounded',
            placeholder: 'ä¾‹: ãƒ•ã‚£ãƒ©ãƒªã‚¢äºˆé˜²è–¬'
          }),
          React.createElement('label', { className: 'flex items-center mt-2' },
            React.createElement('input', {
              type: 'checkbox',
              checked: formData.isVaccine,
              onChange: (e) => setFormData({...formData, isVaccine: e.target.checked}),
              className: 'mr-2'
            }),
            'äºˆé˜²æ¥ç¨®'
          )
        ),
        React.createElement('div', null,
          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'ãƒ¡ãƒ¢'),
          React.createElement('textarea', {
            value: formData.memo,
            onChange: (e) => setFormData({...formData, memo: e.target.value}),
            className: 'w-full p-2 border rounded',
            rows: 3,
            placeholder: 'è©³ç´°ã‚’ãƒ¡ãƒ¢...'
          })
        ),
        React.createElement('div', { className: 'flex gap-2' },
          React.createElement('button', {
            onClick: handleSubmit,
            className: 'flex-1 bg-blue-500 text-white py-2 rounded'
          }, 'ä¿å­˜'),
          React.createElement('button', {
            onClick: onCancel,
            className: 'flex-1 bg-gray-300 py-2 rounded'
          }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
        )
      );
    }
    function App() {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [isWalking, setIsWalking] = useState(false);
      const [currentWalk, setCurrentWalk] = useState(null);
      const [walks, setWalks] = useState([]);
      const [healthRecords, setHealthRecords] = useState([]);
      const [walkers, setWalkers] = useState([]);
      const [selectedWalkers, setSelectedWalkers] = useState([]);
      const [loading, setLoading] = useState(true);
      const [newWalkerName, setNewWalkerName] = useState('');
      const [showAddWalker, setShowAddWalker] = useState(false);
      const [uploadingPhotos, setUploadingPhotos] = useState(false);
      const [photos, setPhotos] = useState([]);
      const [statsView, setStatsView] = useState('week');
      const [showHealthForm, setShowHealthForm] = useState(false);
      const [healthType, setHealthType] = useState('hospital');
      const [editingWalk, setEditingWalk] = useState(null);
      const [showMap, setShowMap] = useState(null);
      const stationaryTimeRef = useRef(0);
      const lastPositionRef = useRef(null);

      useEffect(() => {
        const unsubscribe = db.collection('walkers').onSnapshot((snapshot) => {
          const walkerList = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          setWalkers(walkerList.sort((a, b) => a.order - b.order));
          setLoading(false);
        });
        return () => unsubscribe();
      }, []);

      useEffect(() => {
        const unsubscribe = db.collection('walks')
          .orderBy('startTime', 'desc')
          .onSnapshot((snapshot) => {
            const walkList = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data(),
              startTime: doc.data().startTime?.toDate(),
              endTime: doc.data().endTime?.toDate()
            }));
            setWalks(walkList);
          });
        return () => unsubscribe();
      }, []);

      useEffect(() => {
        const unsubscribe = db.collection('health')
          .orderBy('date', 'desc')
          .onSnapshot((snapshot) => {
            const records = snapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data(),
              date: doc.data().date?.toDate()
            }));
            setHealthRecords(records);
          });
        return () => unsubscribe();
      }, []);

      const toggleWalker = (walkerName) => {
        setSelectedWalkers(prev => {
          if (prev.includes(walkerName)) {
            return prev.filter(w => w !== walkerName);
          } else {
            if (prev.length >= 10) {
              alert('æ•£æ­©è€…ã¯æœ€å¤§10äººã¾ã§ã§ã™');
              return prev;
            }
            return [...prev, walkerName];
          }
        });
      };

      const addWalker = async () => {
        if (!newWalkerName.trim()) return;
        await db.collection('walkers').add({
          name: newWalkerName.trim(),
          order: walkers.length
        });
        setNewWalkerName('');
        setShowAddWalker(false);
      };

      const deleteWalker = async (walkerId) => {
        if (confirm('ã“ã®æ•£æ­©è€…ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
          await db.collection('walkers').doc(walkerId).delete();
        }
      };

      const handlePhotoUpload = async (e) => {
        const files = Array.from(e.target.files);
        if (photos.length + files.length > 4) {
          alert('å†™çœŸã¯æœ€å¤§4æšã¾ã§ã§ã™');
          return;
        }
        setUploadingPhotos(true);
        const uploadedUrls = [];
        for (const file of files) {
          const storageRef = storage.ref(`walks/${Date.now()}_${file.name}`);
          await storageRef.put(file);
          const url = await storageRef.getDownloadURL();
          uploadedUrls.push(url);
        }
        setPhotos([...photos, ...uploadedUrls]);
        setUploadingPhotos(false);
      };

      const removePhoto = (index) => {
        setPhotos(photos.filter((_, i) => i !== index));
      };

      const calculateDistance = (lat1, lng1, lat2, lng2) => {
        const R = 6371000;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLng = (lng2 - lng1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                 Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                 Math.sin(dLng/2) * Math.sin(dLng/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
      };

      const calculateTotalDistance = (positions) => {
        if (positions.length < 2) return 0;
        let total = 0;
        for (let i = 1; i < positions.length; i++) {
          total += calculateDistance(
            positions[i-1].lat, positions[i-1].lng,
            positions[i].lat, positions[i].lng
          );
        }
        return total;
      };

      const startWalk = () => {
        if (selectedWalkers.length === 0) {
            alert('æ•£æ­©è€…ã‚’é¸æŠã—ã¦ãã ã•ã„');
            return;
        }
        if (!navigator.geolocation) {
            alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“');
            return;
        }
        const walk = {
            walkers: selectedWalkers,
            startTime: new Date(),
            positions: [],
            pee: false,
            poo: false,
            water: false,
            memo: '',
            photos: []
        };
        // é«˜ç²¾åº¦ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
        navigator.geolocation.getCurrentPosition(
            (position) => {
            walk.positions.push({
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                time: new Date(),
                accuracy: position.coords.accuracy
            });
            lastPositionRef.current = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                time: Date.now()
            };
            stationaryTimeRef.current = 0;
            setCurrentWalk(walk);
            setIsWalking(true);
            setPhotos([]);
            },
            (error) => {
            alert('ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ä½ç½®æƒ…å ±ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚');
            },
            {
            enableHighAccuracy: true,  // é«˜ç²¾åº¦ãƒ¢ãƒ¼ãƒ‰
            timeout: 10000,
            maximumAge: 0
            }
        );
        };

        useEffect(() => {
        if (!isWalking || !currentWalk) return;
        const interval = setInterval(() => {
            navigator.geolocation.getCurrentPosition(
            (position) => {
                // ç²¾åº¦ãŒ50mä»¥å†…ã®å ´åˆã®ã¿è¨˜éŒ²
                if (position.coords.accuracy <= 50) {
                const newPos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                    time: new Date(),
                    accuracy: position.coords.accuracy
                };
                if (lastPositionRef.current) {
                    const distance = calculateDistance(
                    lastPositionRef.current.lat,
                    lastPositionRef.current.lng,
                    newPos.lat,
                    newPos.lng
                    );
                    if (distance <= 10) {
                    stationaryTimeRef.current += 5;  // 5ç§’é–“éš”ã«å¤‰æ›´
                    if (stationaryTimeRef.current >= 300) {
                        if (confirm('5åˆ†é–“ãã®å ´ã«ã¨ã©ã¾ã£ã¦ã„ã¾ã™ã€‚æ•£æ­©ã‚’çµ‚äº†ã—ã¾ã™ã‹?')) {
                        endWalk();
                        } else {
                        stationaryTimeRef.current = 0;
                        }
                    }
                    } else {
                    stationaryTimeRef.current = 0;
                    }
                    lastPositionRef.current = {
                    lat: newPos.lat,
                    lng: newPos.lng,
                    time: Date.now()
                    };
                }
                setCurrentWalk(prev => ({
                    ...prev,
                    positions: [...prev.positions, newPos]
                }));
                }
            },
            (error) => {
                console.log('GPSå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            },
            {
                enableHighAccuracy: true,  // é«˜ç²¾åº¦ãƒ¢ãƒ¼ãƒ‰
                timeout: 10000,
                maximumAge: 0
            }
            );
        }, 5000);  // 10ç§’â†’5ç§’ã«å¤‰æ›´
        return () => clearInterval(interval);
        }, [isWalking, currentWalk]);

      const endWalk = async () => {
        if (!currentWalk) return;
        const endTime = new Date();
        const duration = Math.floor((endTime - currentWalk.startTime) / 60000);
        const distance = calculateTotalDistance(currentWalk.positions);
        await db.collection('walks').add({
          walkers: currentWalk.walkers,
          startTime: firebase.firestore.Timestamp.fromDate(currentWalk.startTime),
          endTime: firebase.firestore.Timestamp.fromDate(endTime),
          duration,
          distance,
          pee: currentWalk.pee,
          poo: currentWalk.poo,
          water: currentWalk.water,
          memo: currentWalk.memo,
          photos: photos,
          positions: currentWalk.positions
        });
        setCurrentWalk(null);
        setIsWalking(false);
        setSelectedWalkers([]);
        setPhotos([]);
        stationaryTimeRef.current = 0;
        lastPositionRef.current = null;
      };

      const updateWalk = async (walkId, data) => {
        await db.collection('walks').doc(walkId).update(data);
        setEditingWalk(null);
      };

      const deleteWalk = async (walkId) => {
        if (confirm('ã“ã®æ•£æ­©è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
          await db.collection('walks').doc(walkId).delete();
        }
      };

      const saveHealthRecord = async (data) => {
        await db.collection('health').add({
          ...data,
          date: firebase.firestore.Timestamp.fromDate(new Date(data.date))
        });
        setShowHealthForm(false);
      };

      const deleteHealthRecord = async (id) => {
        if (confirm('ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
          await db.collection('health').doc(id).delete();
        }
      };

      const formatDate = (date) => {
        if (!date) return '';
        const d = new Date(date);
        return `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`;
      };

      const formatDateOnly = (date) => {
        if (!date) return '';
        const d = new Date(date);
        return `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
      };

      const getStats = (period) => {
        const now = new Date();
        const startDate = new Date();
        if (period === 'week') {
          startDate.setDate(now.getDate() - 7);
        } else if (period === 'month') {
          startDate.setMonth(now.getMonth() - 1);
        } else if (period === 'year') {
          startDate.setFullYear(now.getFullYear() - 1);
        } else {
          startDate.setFullYear(2000, 0, 1);
        }
        const filteredWalks = period === 'all' ? walks : walks.filter(w => w.startTime >= startDate);
        const totalDistance = filteredWalks.reduce((sum, w) => sum + (w.distance || 0), 0);
        const totalDuration = filteredWalks.reduce((sum, w) => sum + (w.duration || 0), 0);
        const walkerStats = {};
        filteredWalks.forEach(w => {
          const walkerList = Array.isArray(w.walkers) ? w.walkers : [w.walkers];
          walkerList.forEach(walker => {
            if (!walkerStats[walker]) {
              walkerStats[walker] = { count: 0, distance: 0, duration: 0 };
            }
            walkerStats[walker].count += 1;
            walkerStats[walker].distance += w.distance || 0;
            walkerStats[walker].duration += w.duration || 0;
          });
        });
        return {
          count: filteredWalks.length,
          totalDistance,
          totalDuration,
          avgDuration: filteredWalks.length > 0 ? totalDuration / filteredWalks.length : 0,
          walkerStats
        };
      };

      const getEarnedBadges = () => {
        const totalCount = walks.length;
        const totalDistance = walks.reduce((sum, w) => sum + (w.distance || 0), 0);
        return badges.filter(badge => badge.condition(totalCount, totalDistance));
      };

      if (loading) {
        return React.createElement('div', { className: 'flex items-center justify-center min-h-screen' },
          React.createElement('div', { className: 'text-lg' }, 'èª­ã¿è¾¼ã¿ä¸­...')
        );
      }

      const stats = getStats(statsView);
      const earnedBadges = getEarnedBadges();
      const recentWalks = walks.slice(0, 5);
      return React.createElement('div', { className: 'max-w-md mx-auto bg-white min-h-screen pb-20' },
        React.createElement('div', { className: 'bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4' },
          React.createElement('h1', { className: 'text-2xl font-bold' }, 'ğŸ• ç¦ã¨ã„ã£ã—ã‚‡ ğŸ•')
        ),
        React.createElement('div', { className: 'flex border-b overflow-x-auto' },
          React.createElement('button', {
            onClick: () => setActiveTab('dashboard'),
            className: `flex-shrink-0 px-4 py-3 ${activeTab === 'dashboard' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰'),
          React.createElement('button', {
            onClick: () => setActiveTab('record'),
            className: `flex-shrink-0 px-4 py-3 ${activeTab === 'record' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'æ•£æ­©è¨˜éŒ²'),
          React.createElement('button', {
            onClick: () => setActiveTab('history'),
            className: `flex-shrink-0 px-4 py-3 ${activeTab === 'history' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'å±¥æ­´'),
          React.createElement('button', {
            onClick: () => setActiveTab('health'),
            className: `flex-shrink-0 px-4 py-3 ${activeTab === 'health' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'å¥åº·ç®¡ç†'),
          React.createElement('button', {
            onClick: () => setActiveTab('stats'),
            className: `flex-shrink-0 px-4 py-3 ${activeTab === 'stats' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'çµ±è¨ˆ'),
          React.createElement('button', {
            onClick: () => setActiveTab('badges'),
            className: `flex-shrink-0 px-4 py-3 ${activeTab === 'badges' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'ãƒãƒƒã‚¸'),
          React.createElement('button', {
            onClick: () => setActiveTab('settings'),
            className: `flex-shrink-0 px-4 py-3 ${activeTab === 'settings' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'è¨­å®š')
        ),
        
        activeTab === 'dashboard' && React.createElement('div', { className: 'p-4' },
          React.createElement('div', { className: 'bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-lg mb-4' },
            React.createElement('h2', { className: 'text-xl font-bold mb-3' }, 'ğŸ“Š ä»Šé€±ã®çµ±è¨ˆ'),
            React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
              React.createElement('div', { className: 'bg-white p-3 rounded text-center' },
                React.createElement('p', { className: 'text-sm text-gray-600' }, 'æ•£æ­©å›æ•°'),
                React.createElement('p', { className: 'text-2xl font-bold text-blue-600' }, getStats('week').count + 'å›')
              ),
              React.createElement('div', { className: 'bg-white p-3 rounded text-center' },
                React.createElement('p', { className: 'text-sm text-gray-600' }, 'åˆè¨ˆè·é›¢'),
                React.createElement('p', { className: 'text-2xl font-bold text-green-600' }, (getStats('week').totalDistance / 1000).toFixed(1) + 'km')
              ),
              React.createElement('div', { className: 'bg-white p-3 rounded text-center' },
                React.createElement('p', { className: 'text-sm text-gray-600' }, 'åˆè¨ˆæ™‚é–“'),
                React.createElement('p', { className: 'text-2xl font-bold text-purple-600' }, getStats('week').totalDuration + 'åˆ†')
              )
            )
          ),
          React.createElement('h3', { className: 'font-bold mb-2' }, 'æœ€è¿‘ã®æ•£æ­©'),
          recentWalks.length === 0 ? React.createElement('p', { className: 'text-center text-gray-500 mt-4' }, 'ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“') :
          React.createElement('div', { className: 'space-y-3' },
            recentWalks.map(walk => React.createElement('div', { key: walk.id, className: 'border rounded-lg p-3 bg-white shadow' },
              React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                React.createElement('div', null,
                  React.createElement('p', { className: 'font-medium' }, 'ğŸ‘¥ ' + (Array.isArray(walk.walkers) ? walk.walkers.join(', ') : (walk.walkers || walk.walker || 'undefined'))),
                  React.createElement('p', { className: 'text-sm text-gray-500' }, formatDate(walk.startTime))
                ),
                React.createElement('div', { className: 'text-right' },
                  React.createElement('p', { className: 'text-sm font-medium' }, 'â±ï¸ ' + walk.duration + 'åˆ†'),
                  React.createElement('p', { className: 'text-sm' }, 'ğŸ“ ' + (walk.distance / 1000).toFixed(2) + 'km')
                )
              ),
              React.createElement('div', { className: 'flex gap-2 text-sm mb-2' },
                walk.pee && React.createElement('span', { className: 'bg-yellow-100 px-2 py-1 rounded' }, 'ğŸ’§ãŠã—ã£ã“'),
                walk.poo && React.createElement('span', { className: 'bg-amber-100 px-2 py-1 rounded' }, 'ğŸ’©ã†ã‚“ã¡'),
                walk.water && React.createElement('span', { className: 'bg-blue-100 px-2 py-1 rounded' }, 'ğŸ’§æ°´')
              ),
              React.createElement('div', { className: 'flex gap-2 mt-2' },
                walk.positions && walk.positions.length > 0 && React.createElement('button', {
                  onClick: () => setShowMap(walk.positions),
                  className: 'text-xs bg-blue-500 text-white px-3 py-1 rounded'
                }, 'ğŸ—ºï¸ åœ°å›³'),
                React.createElement('button', {
                  onClick: () => setEditingWalk(walk),
                  className: 'text-xs bg-gray-500 text-white px-3 py-1 rounded'
                }, 'âœï¸ ç·¨é›†'),
                React.createElement('button', {
                  onClick: () => deleteWalk(walk.id),
                  className: 'text-xs bg-red-500 text-white px-3 py-1 rounded'
                }, 'ğŸ—‘ï¸ å‰Šé™¤')
              )
            ))
          )
        ),

        activeTab === 'record' && React.createElement('div', { className: 'p-4' },
          !isWalking ? React.createElement('div', { className: 'space-y-4' },
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æ•£æ­©è€… (æœ€å¤§10äºº)'),
              React.createElement('div', { className: 'space-y-2' },
                walkers.map(w => React.createElement('label', { 
                  key: w.id, 
                  className: 'flex items-center p-2 border rounded cursor-pointer hover:bg-gray-50'
                },
                  React.createElement('input', {
                    type: 'checkbox',
                    checked: selectedWalkers.includes(w.name),
                    onChange: () => toggleWalker(w.name),
                    className: 'mr-2 w-5 h-5'
                  }),
                  React.createElement('span', null, w.name)
                ))
              ),
              selectedWalkers.length > 0 && React.createElement('p', { className: 'text-sm text-gray-600 mt-2' },
                'é¸æŠä¸­: ' + selectedWalkers.join(', ')
              )
            ),
            React.createElement('button', {
              onClick: startWalk,
              className: 'w-full bg-green-500 text-white py-4 rounded-lg text-lg font-bold hover:bg-green-600'
            }, 'ğŸš¶ æ•£æ­©é–‹å§‹')
          ) : React.createElement('div', { className: 'space-y-4' },
            React.createElement('div', { className: 'bg-blue-50 p-4 rounded-lg' },
              React.createElement('p', { className: 'text-sm text-gray-600 mb-1' }, 'ğŸ‘¥ æ•£æ­©è€…: ' + currentWalk?.walkers.join(', ')),
              React.createElement('p', { className: 'text-sm text-gray-600 mb-1' }, 'â±ï¸ çµŒéæ™‚é–“: ' + Math.floor((new Date() - currentWalk?.startTime) / 60000) + 'åˆ†'),
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'ğŸ“ è·é›¢: ' + (calculateTotalDistance(currentWalk?.positions || []) / 1000).toFixed(2) + 'km')
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'è¨˜éŒ²'),
              React.createElement('div', { className: 'grid grid-cols-3 gap-2' },
                React.createElement('button', {
                  onClick: () => setCurrentWalk({...currentWalk, pee: !currentWalk.pee}),
                  className: `py-3 rounded-lg border-2 ${currentWalk?.pee ? 'bg-yellow-100 border-yellow-500' : 'border-gray-300'}`
                }, 'ğŸ’§ ãŠã—ã£ã“'),
                React.createElement('button', {
                  onClick: () => setCurrentWalk({...currentWalk, poo: !currentWalk.poo}),
                  className: `py-3 rounded-lg border-2 ${currentWalk?.poo ? 'bg-amber-100 border-amber-500' : 'border-gray-300'}`
                }, 'ğŸ’© ã†ã‚“ã¡'),
                React.createElement('button', {
                  onClick: () => setCurrentWalk({...currentWalk, water: !currentWalk.water}),
                  className: `py-3 rounded-lg border-2 ${currentWalk?.water ? 'bg-blue-100 border-blue-500' : 'border-gray-300'}`
                }, 'ğŸ’§ æ°´')
              )
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'å†™çœŸ (æœ€å¤§4æš)'),
              React.createElement('div', { className: 'grid grid-cols-4 gap-2 mb-2' },
                photos.map((url, i) => React.createElement('div', { key: i, className: 'relative' },
                  React.createElement('img', { src: url, className: 'w-full h-20 object-cover rounded' }),
                  React.createElement('button', {
                    onClick: () => removePhoto(i),
                    className: 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 text-xs'
                  }, 'Ã—')
                ))
              ),
              photos.length < 4 && React.createElement('input', {
                type: 'file',
                accept: 'image/*',
                multiple: true,
                onChange: handlePhotoUpload,
                disabled: uploadingPhotos,
                className: 'w-full text-sm'
              }),
              uploadingPhotos && React.createElement('p', { className: 'text-sm text-gray-500' }, 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...')
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ãƒ¡ãƒ¢'),
              React.createElement('textarea', {
                value: currentWalk?.memo || '',
                onChange: (e) => setCurrentWalk({...currentWalk, memo: e.target.value}),
                className: 'w-full p-2 border rounded-lg',
                rows: 3,
                placeholder: 'æ°—ã¥ã„ãŸã“ã¨ã‚’ãƒ¡ãƒ¢...'
              })
            ),
            React.createElement('button', {
              onClick: endWalk,
              className: 'w-full bg-red-500 text-white py-4 rounded-lg text-lg font-bold hover:bg-red-600'
            }, 'ğŸ æ•£æ­©çµ‚äº†')
          )
        ),
        
        activeTab === 'history' && React.createElement('div', { className: 'p-4' },
          walks.length === 0 ? React.createElement('p', { className: 'text-center text-gray-500 mt-8' }, 'ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“') :
          React.createElement('div', { className: 'space-y-3' },
            walks.map(walk => React.createElement('div', { key: walk.id, className: 'border rounded-lg p-3 bg-white shadow' },
              React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                React.createElement('div', null,
                  React.createElement('p', { className: 'font-medium' }, 'ğŸ‘¥ ' + (Array.isArray(walk.walkers) ? walk.walkers.join(', ') : (walk.walkers || walk.walker || 'undefined'))),
                  React.createElement('p', { className: 'text-sm text-gray-500' }, formatDate(walk.startTime))
                ),
                React.createElement('div', { className: 'text-right' },
                  React.createElement('p', { className: 'text-sm font-medium' }, 'â±ï¸ ' + walk.duration + 'åˆ†'),
                  React.createElement('p', { className: 'text-sm' }, 'ğŸ“ ' + (walk.distance / 1000).toFixed(2) + 'km')
                )
              ),
              React.createElement('div', { className: 'flex gap-2 text-sm mb-2' },
                walk.pee && React.createElement('span', { className: 'bg-yellow-100 px-2 py-1 rounded' }, 'ğŸ’§ãŠã—ã£ã“'),
                walk.poo && React.createElement('span', { className: 'bg-amber-100 px-2 py-1 rounded' }, 'ğŸ’©ã†ã‚“ã¡'),
                walk.water && React.createElement('span', { className: 'bg-blue-100 px-2 py-1 rounded' }, 'ğŸ’§æ°´')
              ),
              walk.photos && walk.photos.length > 0 && React.createElement('div', { className: 'grid grid-cols-4 gap-1 mb-2' },
                walk.photos.map((url, i) => React.createElement('img', { key: i, src: url, className: 'w-full h-16 object-cover rounded' }))
              ),
              walk.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-2 border-t pt-2' }, walk.memo),
              React.createElement('div', { className: 'flex gap-2 mt-2' },
                walk.positions && walk.positions.length > 0 && React.createElement('button', {
                  onClick: () => setShowMap(walk.positions),
                  className: 'text-xs bg-blue-500 text-white px-3 py-1 rounded'
                }, 'ğŸ—ºï¸ åœ°å›³'),
                React.createElement('button', {
                  onClick: () => setEditingWalk(walk),
                  className: 'text-xs bg-gray-500 text-white px-3 py-1 rounded'
                }, 'âœï¸ ç·¨é›†'),
                React.createElement('button', {
                  onClick: () => deleteWalk(walk.id),
                  className: 'text-xs bg-red-500 text-white px-3 py-1 rounded'
                }, 'ğŸ—‘ï¸ å‰Šé™¤')
              )
            ))
          )
        ),
        
        activeTab === 'health' && React.createElement('div', { className: 'p-4' },
          !showHealthForm ? React.createElement('div', null,
            React.createElement('div', { className: 'grid grid-cols-2 gap-2 mb-4' },
              React.createElement('button', {
                onClick: () => { setHealthType('hospital'); setShowHealthForm(true); },
                className: 'bg-red-100 p-4 rounded-lg text-center'
              }, 'ğŸ¥ ç—…é™¢'),
              React.createElement('button', {
                onClick: () => { setHealthType('grooming'); setShowHealthForm(true); },
                className: 'bg-pink-100 p-4 rounded-lg text-center'
              }, 'âœ‚ï¸ æ•£é«ª'),
              React.createElement('button', {
                onClick: () => { setHealthType('bath'); setShowHealthForm(true); },
                className: 'bg-blue-100 p-4 rounded-lg text-center'
              }, 'ğŸ› å…¥æµ´'),
              React.createElement('button', {
                onClick: () => { setHealthType('medicine'); setShowHealthForm(true); },
                className: 'bg-green-100 p-4 rounded-lg text-center'
              }, 'ğŸ’Š è–¬')
            ),
            React.createElement('div', { className: 'space-y-2' },
              healthRecords.map(record => React.createElement('div', { key: record.id, className: 'border rounded-lg p-3 bg-white shadow' },
                React.createElement('div', { className: 'flex justify-between items-start' },
                  React.createElement('div', null,
                    React.createElement('p', { className: 'font-medium' },
                      record.type === 'hospital' ? 'ğŸ¥ ç—…é™¢' :
                      record.type === 'grooming' ? 'âœ‚ï¸ æ•£é«ª' :
                      record.type === 'bath' ? 'ğŸ› å…¥æµ´' : 'ğŸ’Š è–¬'
                    ),
                    React.createElement('p', { className: 'text-sm text-gray-500' }, formatDateOnly(record.date)),
                    record.type === 'hospital' && record.hospitalName && React.createElement('p', { className: 'text-sm' }, 'ç—…é™¢: ' + record.hospitalName),
                    record.type === 'hospital' && record.reason && React.createElement('p', { className: 'text-sm' }, 'ç†ç”±: ' + record.reason),
                    record.type === 'grooming' && record.groomedBy && React.createElement('p', { className: 'text-sm' }, 
                      record.groomedBy === 'walker' ? 'æ•£æ­©è€…: ' + (record.walker || '') : 'åº—èˆ—: ' + (record.shopName || '')
                    ),
                    record.type === 'medicine' && record.medicineType && React.createElement('p', { className: 'text-sm' }, 'ç¨®é¡: ' + record.medicineType),
                    record.type === 'medicine' && record.isVaccine && React.createElement('p', { className: 'text-sm text-red-600' }, 'äºˆé˜²æ¥ç¨®'),
                    record.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-1' }, record.memo)
                  ),
                  React.createElement('button', {
                    onClick: () => deleteHealthRecord(record.id),
                    className: 'text-red-500 text-sm'
                  }, 'å‰Šé™¤')
                )
              ))
            )
          ) : React.createElement(HealthForm, {
            type: healthType,
            walkers: walkers,
            onSave: saveHealthRecord,
            onCancel: () => setShowHealthForm(false)
          })
        ),
        
        activeTab === 'stats' && React.createElement('div', { className: 'p-4' },
          React.createElement('div', { className: 'flex gap-2 mb-4 overflow-x-auto' },
            React.createElement('button', {
              onClick: () => setStatsView('week'),
              className: `flex-shrink-0 px-4 py-2 rounded ${statsView === 'week' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`
            }, 'é€±é–“'),
            React.createElement('button', {
              onClick: () => setStatsView('month'),
              className: `flex-shrink-0 px-4 py-2 rounded ${statsView === 'month' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`
            }, 'æœˆé–“'),
            React.createElement('button', {
              onClick: () => setStatsView('year'),
              className: `flex-shrink-0 px-4 py-2 rounded ${statsView === 'year' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`
            }, 'å¹´é–“'),
            React.createElement('button', {
              onClick: () => setStatsView('all'),
              className: `flex-shrink-0 px-4 py-2 rounded ${statsView === 'all' ? 'bg-blue-500 text-white' : 'bg-gray-200'}`
            }, 'å…¨æœŸé–“')
          ),
          React.createElement('div', { className: 'space-y-4' },
            React.createElement('div', { className: 'bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-lg' },
              React.createElement('h3', { className: 'font-bold mb-2' }, 'ğŸ“Š ' + 
                (statsView === 'week' ? 'é€±é–“' : statsView === 'month' ? 'æœˆé–“' : statsView === 'year' ? 'å¹´é–“' : 'å…¨æœŸé–“') + 'ãƒ¬ãƒãƒ¼ãƒˆ'
              ),
              React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                React.createElement('div', { className: 'bg-white p-3 rounded' },
                  React.createElement('p', { className: 'text-sm text-gray-600' }, 'æ•£æ­©å›æ•°'),
                  React.createElement('p', { className: 'text-2xl font-bold text-blue-600' }, stats.count + 'å›')
                ),
                React.createElement('div', { className: 'bg-white p-3 rounded' },
                  React.createElement('p', { className: 'text-sm text-gray-600' }, 'åˆè¨ˆè·é›¢'),
                  React.createElement('p', { className: 'text-2xl font-bold text-green-600' }, (stats.totalDistance / 1000).toFixed(1) + 'km')
                ),
                React.createElement('div', { className: 'bg-white p-3 rounded' },
                  React.createElement('p', { className: 'text-sm text-gray-600' }, 'åˆè¨ˆæ™‚é–“'),
                  React.createElement('p', { className: 'text-2xl font-bold text-purple-600' }, stats.totalDuration + 'åˆ†')
                ),
                React.createElement('div', { className: 'bg-white p-3 rounded' },
                  React.createElement('p', { className: 'text-sm text-gray-600' }, 'å¹³å‡æ™‚é–“'),
                  React.createElement('p', { className: 'text-2xl font-bold text-orange-600' }, Math.round(stats.avgDuration) + 'åˆ†')
                )
              )
            ),
            React.createElement('div', { className: 'bg-white p-4 rounded-lg shadow' },
              React.createElement('h3', { className: 'font-bold mb-3' }, 'ğŸ‘¥ æ•£æ­©è€…åˆ¥çµ±è¨ˆ'),
              Object.keys(stats.walkerStats).length === 0 ? 
                React.createElement('p', { className: 'text-gray-500 text-center' }, 'ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“') :
                React.createElement('div', { className: 'space-y-3' },
                  Object.entries(stats.walkerStats)
                    .sort((a, b) => b[1].count - a[1].count)
                    .map(([name, data]) => React.createElement('div', { key: name, className: 'border-b pb-2' },
                      React.createElement('p', { className: 'font-medium mb-1' }, name),
                      React.createElement('div', { className: 'grid grid-cols-3 gap-2 text-sm' },
                        React.createElement('div', null,
                          React.createElement('span', { className: 'text-gray-600' }, 'å›æ•°: '),
                          React.createElement('span', { className: 'font-bold' }, data.count + 'å›')
                        ),
                        React.createElement('div', null,
                          React.createElement('span', { className: 'text-gray-600' }, 'è·é›¢: '),
                          React.createElement('span', { className: 'font-bold' }, (data.distance / 1000).toFixed(1) + 'km')
                        ),
                        React.createElement('div', null,
                          React.createElement('span', { className: 'text-gray-600' }, 'æ™‚é–“: '),
                          React.createElement('span', { className: 'font-bold' }, data.duration + 'åˆ†')
                        )
                      )
                    ))
                )
            )
          )
        ),
        
        activeTab === 'badges' && React.createElement('div', { className: 'p-4' },
          React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'ğŸ† å®Ÿç¸¾ãƒ»ãƒãƒƒã‚¸'),
          React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
            badges.map(badge => {
              const earned = earnedBadges.find(b => b.id === badge.id);
              return React.createElement('div', {
                key: badge.id,
                className: `p-4 rounded-lg text-center ${earned ? 'bg-gradient-to-br from-yellow-100 to-orange-100 border-2 border-yellow-400' : 'bg-gray-100 opacity-50'}`
              },
                React.createElement('div', { className: 'text-4xl mb-2' }, badge.icon),
                React.createElement('p', { className: 'font-bold text-sm' }, badge.name),
                earned && React.createElement('p', { className: 'text-xs text-green-600 mt-1' }, 'âœ“ ç²å¾—æ¸ˆã¿')
              );
            })
          ),
          React.createElement('div', { className: 'mt-6 bg-blue-50 p-4 rounded-lg' },
            React.createElement('h3', { className: 'font-bold mb-2' }, 'ğŸ“ˆ ã‚ãªãŸã®è¨˜éŒ²'),
            React.createElement('p', { className: 'text-sm mb-1' }, 'ç·æ•£æ­©å›æ•°: ' + walks.length + 'å›'),
            React.createElement('p', { className: 'text-sm' }, 'ç·è·é›¢: ' + (walks.reduce((sum, w) => sum + (w.distance || 0), 0) / 1000).toFixed(1) + 'km')
          )
        ),
        
        activeTab === 'settings' && React.createElement('div', { className: 'p-4' },
          React.createElement('h2', { className: 'text-lg font-bold mb-4' }, 'æ•£æ­©è€…ã®ç®¡ç†'),
          React.createElement('div', { className: 'space-y-2 mb-4' },
            walkers.map(w => React.createElement('div', { key: w.id, className: 'flex items-center justify-between p-2 border rounded' },
              React.createElement('span', null, w.name),
              React.createElement('button', {
                onClick: () => deleteWalker(w.id),
                className: 'text-red-500 text-sm'
              }, 'å‰Šé™¤')
            ))
          ),
          !showAddWalker ? React.createElement('button', {
            onClick: () => setShowAddWalker(true),
            className: 'w-full bg-blue-500 text-white py-2 rounded'
          }, '+ æ•£æ­©è€…ã‚’è¿½åŠ ') : React.createElement('div', { className: 'space-y-2' },
            React.createElement('input', {
              type: 'text',
              value: newWalkerName,
              onChange: (e) => setNewWalkerName(e.target.value),
              placeholder: 'åå‰ã‚’å…¥åŠ›',
              className: 'w-full p-2 border rounded'
            }),
            React.createElement('div', { className: 'flex gap-2' },
              React.createElement('button', {
                onClick: addWalker,
                className: 'flex-1 bg-green-500 text-white py-2 rounded'
              }, 'è¿½åŠ '),
              React.createElement('button', {
                onClick: () => {
                  setShowAddWalker(false);
                  setNewWalkerName('');
                },
                className: 'flex-1 bg-gray-300 py-2 rounded'
              }, 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«')
            )
          )
        ),
        
        editingWalk && React.createElement(WalkEditForm, {
          walk: editingWalk,
          walkers: walkers,
          onSave: (data) => updateWalk(editingWalk.id, data),
          onCancel: () => setEditingWalk(null)
        }),
        
        showMap && React.createElement(MapView, {
          positions: showMap,
          onClose: () => setShowMap(null)
        })
      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById('app'));
  </script>
</body>
</html>
