<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŠ¬ã®æ•£æ­©è¨˜éŒ²ã‚¢ãƒ—ãƒª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="app"></div>

  <script>
    const { useState, useEffect } = React;

    function App() {
      const [activeTab, setActiveTab] = useState('record');
      const [isWalking, setIsWalking] = useState(false);
      const [currentWalk, setCurrentWalk] = useState(null);
      const [walks, setWalks] = useState([]);
      const [walkers, setWalkers] = useState(['å¤ªéƒ', 'èŠ±å­', 'ãŠæ¯ã•ã‚“', 'ãŠçˆ¶ã•ã‚“']);
      const [selectedWalker, setSelectedWalker] = useState('');
      
      useEffect(() => {
        const saved = localStorage.getItem('dogWalks');
        if (saved) setWalks(JSON.parse(saved));
      }, []);

      useEffect(() => {
        localStorage.setItem('dogWalks', JSON.stringify(walks));
      }, [walks]);

      const startWalk = () => {
        if (!selectedWalker) {
          alert('æ•£æ­©è€…ã‚’é¸æŠã—ã¦ãã ã•ã„');
          return;
        }
        
        if (!navigator.geolocation) {
          alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“');
          return;
        }

        const walk = {
          id: Date.now(),
          walker: selectedWalker,
          startTime: new Date(),
          positions: [],
          pee: false,
          poo: false,
          memo: ''
        };

        navigator.geolocation.getCurrentPosition(
          (position) => {
            walk.positions.push({
              lat: position.coords.latitude,
              lng: position.coords.longitude,
              time: new Date()
            });
            setCurrentWalk(walk);
            setIsWalking(true);
          },
          (error) => {
            alert('ä½ç½®æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ä½ç½®æƒ…å ±ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚');
          }
        );
      };

      useEffect(() => {
        if (!isWalking || !currentWalk) return;

        const interval = setInterval(() => {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              setCurrentWalk(prev => ({
                ...prev,
                positions: [...prev.positions, {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude,
                  time: new Date()
                }]
              }));
            }
          );
        }, 10000);

        return () => clearInterval(interval);
      }, [isWalking, currentWalk]);

      const calculateDistance = (positions) => {
        if (positions.length < 2) return 0;
        
        let total = 0;
        for (let i = 1; i < positions.length; i++) {
          const lat1 = positions[i-1].lat * Math.PI / 180;
          const lat2 = positions[i].lat * Math.PI / 180;
          const dLat = (positions[i].lat - positions[i-1].lat) * Math.PI / 180;
          const dLng = (positions[i].lng - positions[i-1].lng) * Math.PI / 180;
          
          const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                   Math.cos(lat1) * Math.cos(lat2) *
                   Math.sin(dLng/2) * Math.sin(dLng/2);
          const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
          total += 6371000 * c;
        }
        return total;
      };

      const endWalk = () => {
        if (!currentWalk) return;
        
        const endTime = new Date();
        const duration = Math.floor((endTime - currentWalk.startTime) / 60000);
        const distance = calculateDistance(currentWalk.positions);
        
        const completedWalk = {
          ...currentWalk,
          endTime,
          duration,
          distance
        };
        
        setWalks([completedWalk, ...walks]);
        setCurrentWalk(null);
        setIsWalking(false);
        setSelectedWalker('');
      };

      const formatDate = (date) => {
        const d = new Date(date);
        return `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`;
      };

      return React.createElement('div', { className: 'max-w-md mx-auto bg-white min-h-screen' },
        React.createElement('div', { className: 'bg-blue-500 text-white p-4' },
          React.createElement('h1', { className: 'text-xl font-bold' }, 'ğŸ• çŠ¬ã®æ•£æ­©è¨˜éŒ²')
        ),
        React.createElement('div', { className: 'flex border-b' },
          React.createElement('button', {
            onClick: () => setActiveTab('record'),
            className: `flex-1 py-3 ${activeTab === 'record' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'è¨˜éŒ²'),
          React.createElement('button', {
            onClick: () => setActiveTab('history'),
            className: `flex-1 py-3 ${activeTab === 'history' ? 'border-b-2 border-blue-500 text-blue-500' : 'text-gray-500'}`
          }, 'å±¥æ­´')
        ),
        activeTab === 'record' && React.createElement('div', { className: 'p-4' },
          !isWalking ? React.createElement('div', { className: 'space-y-4' },
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æ•£æ­©è€…'),
              React.createElement('select', {
                value: selectedWalker,
                onChange: (e) => setSelectedWalker(e.target.value),
                className: 'w-full p-2 border rounded'
              },
                React.createElement('option', { value: '' }, 'é¸æŠã—ã¦ãã ã•ã„'),
                walkers.map(w => React.createElement('option', { key: w, value: w }, w))
              )
            ),
            React.createElement('button', {
              onClick: startWalk,
              className: 'w-full bg-green-500 text-white py-4 rounded-lg text-lg font-bold'
            }, 'æ•£æ­©é–‹å§‹')
          ) : React.createElement('div', { className: 'space-y-4' },
            React.createElement('div', { className: 'bg-blue-50 p-4 rounded' },
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'æ•£æ­©è€…: ' + currentWalk?.walker),
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'çµŒéæ™‚é–“: ' + Math.floor((new Date() - currentWalk?.startTime) / 60000) + 'åˆ†'),
              React.createElement('p', { className: 'text-sm text-gray-600' }, 'è·é›¢: ' + (calculateDistance(currentWalk?.positions || []) / 1000).toFixed(2) + 'km')
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'æ’æ³„'),
              React.createElement('div', { className: 'flex gap-2' },
                React.createElement('button', {
                  onClick: () => setCurrentWalk({...currentWalk, pee: !currentWalk.pee}),
                  className: `flex-1 py-3 rounded border-2 ${currentWalk?.pee ? 'bg-yellow-100 border-yellow-500' : 'border-gray-300'}`
                }, 'ğŸ’§ ãŠã—ã£ã“'),
                React.createElement('button', {
                  onClick: () => setCurrentWalk({...currentWalk, poo: !currentWalk.poo}),
                  className: `flex-1 py-3 rounded border-2 ${currentWalk?.poo ? 'bg-yellow-100 border-yellow-700' : 'border-gray-300'}`
                }, 'ğŸ’© ã†ã‚“ã¡')
              )
            ),
            React.createElement('div', null,
              React.createElement('label', { className: 'block text-sm font-medium mb-2' }, 'ãƒ¡ãƒ¢'),
              React.createElement('textarea', {
                value: currentWalk?.memo || '',
                onChange: (e) => setCurrentWalk({...currentWalk, memo: e.target.value}),
                className: 'w-full p-2 border rounded',
                rows: 3,
                placeholder: 'æ°—ã¥ã„ãŸã“ã¨ã‚’ãƒ¡ãƒ¢...'
              })
            ),
            React.createElement('button', {
              onClick: endWalk,
              className: 'w-full bg-red-500 text-white py-4 rounded-lg text-lg font-bold'
            }, 'æ•£æ­©çµ‚äº†')
          )
        ),
        activeTab === 'history' && React.createElement('div', { className: 'p-4' },
          walks.length === 0 ? React.createElement('p', { className: 'text-center text-gray-500 mt-8' }, 'ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“') :
          React.createElement('div', { className: 'space-y-3' },
            walks.map(walk => React.createElement('div', { key: walk.id, className: 'border rounded p-3 bg-white shadow-sm' },
              React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                React.createElement('div', null,
                  React.createElement('p', { className: 'font-medium' }, walk.walker),
                  React.createElement('p', { className: 'text-sm text-gray-500' }, formatDate(walk.startTime))
                ),
                React.createElement('div', { className: 'text-right' },
                  React.createElement('p', { className: 'text-sm' }, walk.duration + 'åˆ†'),
                  React.createElement('p', { className: 'text-sm' }, (walk.distance / 1000).toFixed(2) + 'km')
                )
              ),
              React.createElement('div', { className: 'flex gap-2 text-sm' },
                walk.pee && React.createElement('span', null, 'ğŸ’§'),
                walk.poo && React.createElement('span', null, 'ğŸ’©')
              ),
              walk.memo && React.createElement('p', { className: 'text-sm text-gray-600 mt-2 border-t pt-2' }, walk.memo)
            ))
          )
        )
      );
    }

    ReactDOM.render(React.createElement(App), document.getElementById('app'));
  </script>
</body>
</html>